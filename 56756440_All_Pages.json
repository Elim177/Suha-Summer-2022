[{"items": [{"tags": ["python", "tensorflow", "tensorflow2.0", "tf.keras"], "owner": {"account_id": 15128062, "reputation": 123, "user_id": 10916789, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cWZooBN96GE/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYEXTkfTssXojxqNAoKO9pq3oWBsQ/mo/photo.jpg?sz=256", "display_name": "Oktai Tatanov", "link": "https://stackoverflow.com/users/10916789/oktai-tatanov"}, "is_answered": true, "view_count": 538, "accepted_answer_id": 56761873, "answer_count": 1, "score": 1, "last_activity_date": 1561496128, "creation_date": 1561473116, "question_id": 56756440, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/56756440/get-input-shape-in-tf-keras-model-imperative-api", "title": "Get input shape in tf.keras.Model (Imperative API)", "body": "<p>I use Tensorflow 2.0 and I have a model that was defined in Imperative API. In call method I use something like this:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>b, h, w, c = images.shape\nk_h, k_w = kernels.shape[2], kernels.shape[3]\n\nimages = tf.transpose(images, [1, 2, 0, 3])  # (h, w, b, c)\nnew_shape = tf.TensorShape([1, h, w, b * c])\nimages = tf.reshape(images, new_shape)\n</code></pre>\n\n<p>When I train my model with custom loop -- no problem. But I want to porting my model to SavedModel format. I use the following function:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>tf.keras.experimental.export_saved_model(\n        model, file_path,\n        serving_only=True,\n        input_signature=[\n                tf.TensorSpec(shape=[None, None, None, 3], dtype=tf.float32),\n            ]\n        )\n</code></pre>\n\n<p>And i got error:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>TypeError: unsupported operand type(s) for *: 'NoneType' and 'int'\n</code></pre>\n\n<p>Moreover, I can't do it even If I specify shape=[1, None, None, 3], because I got:</p>\n\n<pre><code>ValueError: Tried to convert 'shape' to a tensor and failed. Error: Cannot convert a partially known TensorShape to a Tensor: (1, None, None, 3)\n</code></pre>\n\n<p>It means that I can't do reshape at all. But I need it. How can I do it?</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 47}]