[{"items": [{"tags": ["tensorflow", "tensorflow-datasets"], "owner": {"account_id": 318348, "reputation": 3762, "user_id": 635523, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5afdae1b0353a803b15582e7cb8a694b?s=256&d=identicon&r=PG", "display_name": "knub", "link": "https://stackoverflow.com/users/635523/knub"}, "is_answered": true, "view_count": 7817, "accepted_answer_id": 50533300, "answer_count": 1, "score": 6, "last_activity_date": 1527265140, "creation_date": 1527256446, "last_edit_date": 1527258190, "question_id": 50530806, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/50530806/using-flat-map-in-tensorflows-dataset-api", "title": "Using flat_map in Tensorflow&#39;s Dataset API", "body": "<p>I'm using the dataset API, reading data as follows:</p>\n\n<pre><code>dataset = tf.data.TFRecordDataset(filename, compression_type=\"GZIP\")\ndataset = dataset.map(lambda str: tf.parse_single_example(str, feature_schema))\n</code></pre>\n\n<p>I now want to use <code>flat_map</code> in order to filter out some, while duplicating some other samples dynamically at training time (this is the input function leading to my model).</p>\n\n<p>The API for <code>flat_map</code> requires to return a <code>Dataset</code> object, however I don't know how to create that. Here's a pseudo-code implementation of what I want to achieve:</p>\n\n<pre><code>def flat_map_impl(tf_example):\n    # Pseudo-code:\n    # if tf_example[\"a\"] == 1:\n    #     return []\n    # else:\n    #     return [tf_example, tf_example]\n\ndataset.flat_map(flat_map_impl)\n</code></pre>\n\n<p>How can I implement this in the <code>flat_map</code> function?</p>\n\n<p>NOTE: I guess it's possible to implement this via a <code>py_func</code>, but I'd prefer to avoid this.</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 85}]