[{"items": [{"tags": ["python", "tensorflow", "keras", "deep-learning"], "owner": {"account_id": 16603255, "reputation": 31, "user_id": 11998355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8ae81e696ed747e2fac83d32b624c7?s=256&d=identicon&r=PG&f=1", "display_name": "francesco", "link": "https://stackoverflow.com/users/11998355/francesco"}, "is_answered": true, "view_count": 1271, "answer_count": 1, "score": 1, "last_activity_date": 1600329650, "creation_date": 1599498939, "question_id": 63781754, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/63781754/valueerror-when-using-data-tensors-as-input-to-a-model", "title": "ValueError: When using data tensors as input to a model", "body": "<p>I'm trying to train a model with GradientTape in Keras. Here is the code:</p>\n<pre><code>@tf.function\ndef train_step(x,y):\n    \n    with tf.GradientTape() as tape:\n                \n        predictions = model.predict(x)\n        \n        loss = compute_loss(y, predections)\n    \n    grads = tape.gradient(loss, model.trainable_variables)\n        \n    optimizer.apply_gradients(zip(grads, model.trainable_variables))\n    \n    return loss\n\nhistory = []\n\nfor iter in tqdm(range(num_iters)):\n    \n    x_batch, y_batch = get_batch(x_train, y_train, batch_dim)\n    loss = train_step(x_batch, y_batch)\n    history.append(loss.numpy().mean())\n    \n</code></pre>\n<p>This code leads to the following error:</p>\n<pre><code>ValueError: When using data tensors as input to a model, you should specify the `steps` argument.\n</code></pre>\n<p>However if I try to call the prediction outside the function as follows:</p>\n<pre><code>history = []\n\nfor iter in tqdm(range(num_iters)):\n    \n    x_batch, y_batch = get_batch(x_train, y_train, batch_dim)       \n    x_hat = model.predict(x_batch)\n</code></pre>\n<p>I get no error...</p>\n<p>Can someone explain me why do I get this behavior from Keras?</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 187}]