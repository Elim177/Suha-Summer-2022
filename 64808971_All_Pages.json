[{"items": [{"tags": ["python", "tensorflow", "keras", "tensorflow2.0", "gradient"], "owner": {"account_id": 19959614, "reputation": 23, "user_id": 14627529, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p0IJDabGgHU/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucnkh2ivdwLLE94riplxx1a9EgZ_rA/s96-c/photo.jpg?sz=256", "display_name": "Pan", "link": "https://stackoverflow.com/users/14627529/pan"}, "is_answered": true, "view_count": 1413, "accepted_answer_id": 64809245, "answer_count": 1, "score": 2, "last_activity_date": 1612961975, "creation_date": 1605202804, "last_edit_date": 1605208147, "question_id": 64808971, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/64808971/typeerror-cannot-convert-value-tensorflow-python-keras-losses-categoricalcross", "title": "TypeError: Cannot convert value &lt;tensorflow.python.keras.losses.CategoricalCrossentropy object ...&gt; to a TensorFlow DType", "body": "<p>I want to implement a Word2Vec using negative sampling with pure TensorFlow 2. When I want to compute the gradient I get this error in the last line. I'm struggling to find the problem.</p>\n<p>the code is fairly simple:</p>\n<pre><code>import tensorflow as tf\nimport numpy as np\n\nx, y = (('self', 'the'), ('self', 'violent'), ('self', 'any')), (1, 0, 0)\ny = tf.convert_to_tensor(y, dtype='float32')\n\nembeding_tensor = tf.keras.layers.Embedding(len(words_lst), embeding_size)\ncontext_tensor = tf.keras.layers.Embedding(len(words_lst), embeding_size)\n\n\nwith tf.GradientTape() as t:    \n      middle = embeding_tensor(word2index[x[0][0]])\n      neighbor_choices = context_tensor(np.asarray([[word2index[i[1]] for i in x]]))\n\n      scores = tf.tensordot(neighbor_choices, middle, 1)\n      prediction = tf.nn.sigmoid(scores)\n      loss = tf.keras.losses.CategoricalCrossentropy(y, prediction)\n\n      g_embed, g_context = t.gradient(loss, [middle, neighbor_choices])\n</code></pre>\n<hr />\n<pre><code>TypeError                                 Traceback (most recent call last)\n&lt;ipython-input-40-fba4cda17cff&gt; in &lt;module&gt;()\n     17       loss = tf.keras.losses.CategoricalCrossentropy(y, prediction)\n     18 \n---&gt; 19       g_embed, g_context = t.gradient(loss, [middle, neighbor_choices])\n\n2 frames\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/framework/dtypes.py in as_dtype(type_value)\n    648 \n    649   raise TypeError(&quot;Cannot convert value %r to a TensorFlow DType.&quot; %\n--&gt; 650                   (type_value,))\n\nTypeError: Cannot convert value &lt;tensorflow.python.keras.losses.CategoricalCrossentropy object at 0x7f3ec9be28d0&gt; to a TensorFlow DType.\n</code></pre>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 144}]