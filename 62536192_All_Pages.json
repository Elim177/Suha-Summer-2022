[{"items": [{"tags": ["progress-bar", "python-3.7", "tensorflow2.0", "tensor"], "owner": {"account_id": 7120877, "reputation": 337, "user_id": 5445548, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/pmGVM.png?s=256&g=1", "display_name": "maracuja", "link": "https://stackoverflow.com/users/5445548/maracuja"}, "is_answered": false, "view_count": 170, "answer_count": 0, "score": 2, "last_activity_date": 1592919769, "creation_date": 1592919769, "question_id": 62536192, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/62536192/converting-a-tensor-into-integer-value-in-a-tf-function-decorated-function", "title": "Converting a tensor into integer value in a tf.function decorated function?", "body": "<p>I'm trying to loop over the tfdataset and run a custom train step on a number of replicas using distributed training. My function is as follows:</p>\n<pre><code>@tf.function\ndef distributedTrainEpoch(self, trainData):\n\n   totalLoss = 0.0\n   totalDice = 0.0\n   i = 0\n   prog = Progbar(self.trainSteps-1)\n\n   for batch in trainData:\n\n      i+=1\n\n      replicaLoss, replicaDice = self.strategy.run(self.trainStep, args=(batch,))\n      totalLoss += self.strategy.reduce(tf.distribute.ReduceOp.SUM, replicaLoss, axis=None)\n      totalDice += self.strategy.reduce(tf.distribute.ReduceOp.SUM, replicaDice, axis=None)\n      prog.update(i)\n\n   return totalLoss, totalDice\n</code></pre>\n<p>The problem here is I'm trying to use the Progress bar from tf.keras.utils.Progbar and when I update it with the integer i, I get a type error problem because i is a tensor since we use @tf.function to execute this code in graph mode rather than eagerly.</p>\n<p>I know in tensorflow 1, I could start a session and call i.eval() but I can't do that here. Does anyone know how I can convert a tensor to it's value under a tf.function?</p>\n<p>I could obviously remove the loop from this function but I don't want to do that.</p>\n<p>Thanks,</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 53}]