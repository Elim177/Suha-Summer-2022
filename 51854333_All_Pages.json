[{"items": [{"tags": ["tensorflow", "keras"], "owner": {"account_id": 963556, "reputation": 1375, "user_id": 987397, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/fa7ae7d9bd13c2d04335c3209865c262?s=256&d=identicon&r=PG", "display_name": "Derk", "link": "https://stackoverflow.com/users/987397/derk"}, "is_answered": true, "view_count": 1367, "answer_count": 2, "score": 2, "last_activity_date": 1592477876, "creation_date": 1534316890, "question_id": 51854333, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/51854333/keras-and-tensorflow-eager-execution", "title": "Keras and tensorflow eager execution", "body": "<p>I have a model from <a href=\"https://github.com/bonlime/keras-deeplab-v3-plus\" rel=\"nofollow noreferrer\">https://github.com/bonlime/keras-deeplab-v3-plus</a> that I try to customize a bit.</p>\n\n<p>I want to run it with Tensorflow Eager mode</p>\n\n<pre><code>from model import Deeplabv3\nimport tensorflow as tf\ntf.enable_eager_execution()\n\nmodel = Deeplabv3(weights='pascal_voc', input_shape=(200,200,3), backbone='mobilenetv2', classes=64)\nbatch = tf.zeros((1,200,200,3))\nf = model(batch)\n</code></pre>\n\n<p>However this gives the error:</p>\n\n<blockquote>\n  <p>model.py\", line 236, in _inverted_res_block\n      in_channels = inputs._keras_shape[-1] AttributeError: 'DeferredTensor' object has no attribute '_keras_shape'</p>\n</blockquote>\n\n<p>It is about this part of the code</p>\n\n<pre><code>def _inverted_res_block(inputs, expansion, stride, alpha, filters, block_id, skip_connection, rate=1):\n    in_channels = inputs._keras_shape[-1]\n    #in_channels = inputs.get_shape()[-1].value\n    #in_channels = tf.shape(inputs)[-1]\n\n    import pdb;pdb.set_trace()\n\n    pointwise_conv_filters = int(filters * alpha)\n    pointwise_filters = _make_divisible(pointwise_conv_filters, 8)\n    x = inputs\n\n    prefix = 'expanded_conv_{}_'.format(block_id)\n    if block_id:\n        # Expand\n\n        x = Conv2D(expansion * in_channels, kernel_size=1, padding='same',\n                   use_bias=False, activation=None,\n                   name=prefix + 'expand')(x)\n</code></pre>\n\n<p>How to solve this?</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 280}]