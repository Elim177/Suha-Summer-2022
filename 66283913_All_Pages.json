[{"items": [{"tags": ["python", "tensorflow", "keras", "gradient"], "owner": {"account_id": 17455022, "reputation": 31, "user_id": 12654107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64e5c8da7c782e0d9a950b73b390d1b8?s=256&d=identicon&r=PG&f=1", "display_name": "Nogh98", "link": "https://stackoverflow.com/users/12654107/nogh98"}, "is_answered": true, "view_count": 873, "answer_count": 1, "score": 3, "last_activity_date": 1632867455, "creation_date": 1613763106, "last_edit_date": 1621421471, "question_id": 66283913, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/66283913/error-in-computing-gradients-in-kerastensorflow-backend", "title": "Error in computing gradients in keras(tensorflow backend)", "body": "<p>I am trying to compute gradients of one of CNN filters from VGG16 w.r.t an image input using tensorflow-gpu version 2.4.1 and Keras version 2.4.3 with the following code:</p>\n<pre><code>from keras.applications import VGG16\nfrom keras import backend as K\nmodel = VGG16(weights = 'imagenet', \n             include_top = False)\nlayer_name = 'block3_conv1'\nfilter_index = 0\nlayer_output = model.get_layer(layer_name).output\nloss = K.mean(layer_output[:, :, :, filter_index])\n\ngrads = K.gradients(loss, model.input)[0]\n\n\n</code></pre>\n<p>this results in the following error:</p>\n<blockquote>\n<p>RuntimeError: tf.gradients is not supported when eager execution is enabled. Use tf.GradientTape instead.</p>\n</blockquote>\n<p>Also trying to use <code>tf.GradientTape</code> raised another error:</p>\n<pre><code>with tf.GradientTape() as gtape:\n    grads = gtape.gradient(loss, model.input)\n</code></pre>\n<blockquote>\n<p>AttributeError: 'KerasTensor' object has no attribute '_id'</p>\n</blockquote>\n<p>trying to disable eager execution did not work either:</p>\n<pre><code>tf.compat.v1.disable_eager_execution()\n</code></pre>\n<p>since it returns gradients as None.\nI would appreciate any kind of information about any way to resolve this issue.\nThanks in advance.</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 251}]