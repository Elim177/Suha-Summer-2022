[{"items": [{"tags": ["python", "tensorflow", "deep-learning", "pytorch"], "owner": {"account_id": 19052928, "reputation": 31, "user_id": 13910718, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-eC4snBvXvPg/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucnNd56DlJHh8wmPedoJXpVW_owwYw/photo.jpg?sz=256", "display_name": "Shijia li", "link": "https://stackoverflow.com/users/13910718/shijia-li"}, "is_answered": true, "view_count": 1701, "answer_count": 1, "score": 1, "last_activity_date": 1596278767, "creation_date": 1596263622, "question_id": 63202478, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/63202478/why-pytorch-is-slower-than-tensorflow-in-read-data", "title": "Why Pytorch is slower than Tensorflow in read data", "body": "<p>I tried two version code for iterate MNIST data to compare the elapsed time.</p>\n<p><strong>Pytorch version</strong></p>\n<pre><code>import os\nos.environ[&quot;CUDA_VISIBLE_DEVICES&quot;] = &quot;0&quot;\nimport torch\nfrom torchvision import datasets, transforms\nimport matplotlib.pyplot as plt\nimport time\ntrain_loader = torch.utils.data.DataLoader(\n    datasets.MNIST('~/data', train=True, download=True,\n                   transform=transforms.Compose([\n                       transforms.ToTensor(),\n                       # transforms.Normalize((0.1307,), (0.3081,))\n                   ])),\n    batch_size=30000, shuffle=True,pin_memory=True,num_workers=4)\ntic = time.time()\nfor epoch in range(0, 5):\n    for batch_idx, (data, target) in enumerate(train_loader):\n        continue\ntoc=time.time()\nprint('elapsed time:',toc-tic)\n</code></pre>\n<p><strong>Tensorflow 2.x version</strong></p>\n<pre><code>import os\nos.environ['TF_CPP_MIN_LOG_LEVEL'] = '3'\nos.environ[&quot;CUDA_VISIBLE_DEVICES&quot;] = &quot;0&quot;\nimport tensorflow as tf\nfrom tensorflow.keras import datasets\nimport time\n(xs, ys), (xs_, ys_) = datasets.mnist.load_data()\n# print('datasets:', xs.shape, ys.shape, xs.min(), xs.max())\nxs = tf.convert_to_tensor(xs, dtype=tf.float32) / 255.\ndb = tf.data.Dataset.from_tensor_slices((xs, ys))\ndb = db.batch(30000)\ntic = time.time()\nfor epoch in range(5):\n    for step, (x, y) in enumerate(db):\n        continue\ntoc = time.time()\nprint('elapsed time:', toc - tic)\n</code></pre>\n<p>And the result are TF elapsed 2s and Pytorch elapsed 15s.\nSo, why Pytorch is slower than Tensorflow in read data?\nAm I setting it wrong?\nThanks!</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 203}]