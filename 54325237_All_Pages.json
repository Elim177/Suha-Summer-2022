[{"items": [{"tags": ["tensorflow"], "owner": {"account_id": 438612, "reputation": 22254, "user_id": 826983, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/B9PSD.jpg?s=256&g=1", "display_name": "Stefan Falk", "link": "https://stackoverflow.com/users/826983/stefan-falk"}, "is_answered": false, "view_count": 127, "answer_count": 2, "score": 0, "last_activity_date": 1548246275, "creation_date": 1548239725, "last_edit_date": 1548241222, "question_id": 54325237, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/54325237/how-to-convert-feature-to-python-object", "title": "How to convert Feature to Python object?", "body": "<p>I have some <code>Example</code>s stored in files in binary format which I am reading \nlike this:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>for fp in shard_filepaths:\n    record_iterator = tf.python_io.tf_record_iterator(path=fp)\n    for record in record_iterator:\n         example = tf.train.Example.FromString(record)\n</code></pre>\n\n<p>Is there a way to map the <code>example</code> into a Python <code>dict</code> or <code>object</code>? </p>\n\n<p>I know I could do something like</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>data = json.loads(MessageToJson(tf.train.Example.FromString(record)))\n</code></pre>\n\n<p>but that will produce a rather complex and unhandy output.</p>\n\n<p>What are my options here?</p>\n\n<hr>\n\n<p>In addition, this is the method (see tensor2tensor <a href=\"https://github.com/tensorflow/tensor2tensor/blob/v.1.12.0/tensor2tensor/data_generators/generator_utils.py#L42\" rel=\"nofollow noreferrer\"><code>to_example(dictionary)</code></a>) that generated the records from a <code>dict</code> to an <code>example</code>:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>def to_example(dictionary):\n    \"\"\"Helper: build tf.Example from (string -&gt; int/float/str list) dictionary.\"\"\"\n\n    features = {}\n\n    for (k, v) in six.iteritems(dictionary):\n        if not v:\n            raise ValueError('Empty generated field: %s' % str((k, v)))\n        if isinstance(v[0], six.integer_types):\n            features[k] = tf.train.Feature(int64_list=tf.train.Int64List(value=v))\n        elif isinstance(v[0], float):\n            features[k] = tf.train.Feature(float_list=tf.train.FloatList(value=v))\n        elif isinstance(v[0], six.string_types):\n            if not six.PY2:  # Convert in python 3.\n                v = [bytes(x, 'utf-8') for x in v]\n            features[k] = tf.train.Feature(bytes_list=tf.train.BytesList(value=v))\n        elif isinstance(v[0], bytes):\n            features[k] = tf.train.Feature(bytes_list=tf.train.BytesList(value=v))\n        else:\n            raise ValueError('Value for %s is not a recognized type; v: %s type: %s' % (k, str(v[0]), str(type(v[0]))))\n\n    return tf.train.Example(features=tf.train.Features(feature=features))\n</code></pre>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 61}]