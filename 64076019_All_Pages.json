[{"items": [{"tags": ["python-3.x", "tensorflow", "aws-lambda", "serverless-framework"], "owner": {"account_id": 11777520, "reputation": 1591, "user_id": 8618380, "user_type": "registered", "accept_rate": 31, "profile_image": "https://graph.facebook.com/10211660306718142/picture?type=large", "display_name": "Alessandro Ceccarelli", "link": "https://stackoverflow.com/users/8618380/alessandro-ceccarelli"}, "is_answered": false, "view_count": 227, "answer_count": 0, "score": 2, "last_activity_date": 1601113531, "creation_date": 1601112740, "last_edit_date": 1601113531, "question_id": 64076019, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/64076019/aws-lambda-remove-unused-libraries-for-tensorflow-2-inference", "title": "AWS Lambda: Remove unused libraries for Tensorflow 2 inference", "body": "<p>I am trying to deploy a Lambda function on AWS, through Serverless, that requires Tensorflow 2, Pandas and Numpy;</p>\n<p>I would like to remove from the <em>serverless.yml</em> file, the Tensorflow libraries not required for inference as briefly done in the following sections:</p>\n<pre><code>(...)\n plugins:\n  - serverless-python-requirements\ncustom:\n  pythonRequirements:\n    dockerizePip: true\n    zip: true\n    slim: true\n    useDownloadCache: true\n    slimPatterns:\n      - &quot;**/tensorboard*&quot;\n      - &quot;**/markdown*&quot;\n      - &quot;**/werkzeug*&quot;\n      - &quot;**/grpc*&quot;\n      - &quot;**/tensorflow/contrib*&quot;\n      - &quot;**/tensorflow/include*&quot;\n      - &quot;**/external/*&quot;\n\n    noDeploy:\n      - boto3\n      - botocore\n      - docutils\n      - jmespath\n      - pip\n      - python-dateutil\n      - s3transfer\n      - setuptools\n      - six \n</code></pre>\n<p>Within my handler.py script, the only Tensorflow-based lines are the following:</p>\n<pre><code># Import a model with Dense layers only\ntf.keras.models.load_model(model_name)\n\n# Run inference\npredictions = model.predict(my_array)\n</code></pre>\n<p>However, whenever I try to deploy the service using &quot;sls deploy&quot;, it raises an error due to file size:</p>\n<pre><code>Uploading service tensorflow-lambda-demo-1234.zip file to S3 (336.22 MB)...\n\n(...)\n\nAn error occurred: HelloLambdaFunction - Unzipped size must be smaller than 262144000 bytes (Service: Lambda, Status Code: 400, Request ID: 3805f9b4-eb32-4d11-b54a-3437bf2b6d6b, Extended Request ID: null).\n</code></pre>\n<p>Which sub-libraries (&quot;slimPatterns&quot;) and whole packages (&quot;noDeploy&quot;) can I further exclude from the deployment package to reduce its size?</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 71}]