[{"items": [{"tags": ["python", "unit-testing", "tensorflow", "tf.keras"], "owner": {"account_id": 2012956, "reputation": 225, "user_id": 1800970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c92ae2616ccf19035e322687bdb735e4?s=256&d=identicon&r=PG", "display_name": "YuseqYaseq", "link": "https://stackoverflow.com/users/1800970/yuseqyaseq"}, "is_answered": false, "view_count": 360, "answer_count": 0, "score": 1, "last_activity_date": 1630680475, "creation_date": 1630678892, "last_edit_date": 1630680475, "question_id": 69046455, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/69046455/how-to-mock-a-tensorflow-model", "title": "How to mock a tensorflow model?", "body": "<p>I would like to test a function that takes a <code>tf.keras</code> model and performs some operations on it. Example function illustrating the problem:</p>\n<pre><code>def func(model, x):\n    with tf.GradientTape() as tape:\n        tape.watch(x)\n        output = model(x)\n        # do some additional stuff with output\n        gradient = np.array(tape.gradient(output, x))\n        # do some additional stuff with gradient\n        return gradient\n</code></pre>\n<p>I wonder what the best idea to mock <code>model</code> is.<br />\nPossible solutions:</p>\n<ol>\n<li><p>Use a small network with set weights. This one is easiest to implement but<br />\na) It takes a longer time to calculate than a simple mock.<br />\nb) It's hard to control what is returned by the model.</p>\n</li>\n<li><p>Mock using unit test or <code>pytest</code>. This one will straight up fail because no computation graph is created which would link <code>x</code> and <code>output</code>.</p>\n</li>\n<li><p>Move <code>tape.gradient(output, x)</code> to another function, then, during tests, mock this function and <code>model(x)</code> using unit test or pytest. I think this one is the best but it makes <code>func</code> less readable (especially if more tf specific elements have to be moved to various other functions).</p>\n</li>\n</ol>\n<p>Is there a better way? Ideally, I would like to:</p>\n<ol>\n<li>Express that this model for a given input <code>x</code> returns a given output <code>y</code>.</li>\n<li>Express that the gradient of a given output <code>y</code> w.r.t. a given input <code>x</code> is <code>z</code>.</li>\n<li>Express that the gradient of a given output <code>y</code> w.r.t. a given layer <code>l</code> is <code>l'</code>.</li>\n<li>Minimize necessary modifications to <code>func</code>.</li>\n</ol>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 19}]