[{"items": [{"tags": ["tensorflow2.0", "tensorboard", "gradienttape"], "owner": {"account_id": 1634551, "reputation": 4290, "user_id": 1508398, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/eceb9b7596b6b99c54458e6cd84a3c18?s=256&d=identicon&r=PG", "display_name": "bit", "link": "https://stackoverflow.com/users/1508398/bit"}, "is_answered": false, "view_count": 932, "answer_count": 1, "score": 4, "last_activity_date": 1612869392, "creation_date": 1597963196, "question_id": 63514062, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/63514062/tensorflow-v2-gradients-not-shown-on-tensorboard-histograms", "title": "tensorflow v2 gradients not shown on tensorboard histograms", "body": "<p>I have a simple neural network for which I am trying to plot the gradients using tensorboard by using  a callback as below:</p>\n<pre><code>class GradientCallback(tf.keras.callbacks.Callback):\n    console = False\n    count = 0\n    run_count = 0\n\n    def on_epoch_end(self, epoch, logs=None):\n        weights = [w for w in self.model.trainable_weights if 'dense' in w.name and 'bias' in w.name]\n        self.run_count += 1\n        run_dir = logdir+&quot;/gradients/run-&quot; + str(self.run_count)\n        with tf.summary.create_file_writer(run_dir).as_default(),tf.GradientTape() as g:\n          # use test data to calculate the gradients\n          _x_batch = test_images_scaled_reshaped[:100]\n          _y_batch = test_labels_enc[:100]\n          g.watch(_x_batch)\n          _y_pred = self.model(_x_batch)  # forward-propagation\n          per_sample_losses = tf.keras.losses.categorical_crossentropy(_y_batch, _y_pred) \n          average_loss = tf.reduce_mean(per_sample_losses) # Compute the loss value\n          gradients = g.gradient(average_loss, self.model.weights) # Compute the gradient\n\n        for t in gradients:\n          tf.summary.histogram(str(self.count), data=t)\n          self.count+=1\n          if self.console:\n                print('Tensor: {}'.format(t.name))\n                print('{}\\n'.format(K.get_value(t)[:10]))\n\n# Set up logging\n!rm -rf ./logs/ # clear old logs\nfrom datetime import datetime\nimport os\nroot_logdir = &quot;logs&quot;\nrun_id = datetime.now().strftime(&quot;%Y%m%d-%H%M%S&quot;)\nlogdir = os.path.join(root_logdir, run_id)\n\n\n# register callbacks, this will be used for tensor board latter\ncallbacks = [\n    tf.keras.callbacks.TensorBoard( log_dir=logdir, histogram_freq=1, \n                                   write_images=True, write_grads = True ),\n    GradientCallback()\n]\n</code></pre>\n<p>Then,I use the callbacks during fit as:</p>\n<pre><code>network.fit(train_pipe, epochs = epochs,batch_size = batch_size, validation_data = val_pipe, callbacks=callbacks)\n</code></pre>\n<p>Now, when I check the tensorboard, I get to see gradients on the left side filter but nothing shows up in the Histogram tab:</p>\n<p><a href=\"https://i.stack.imgur.com/lHf17.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/lHf17.png\" alt=\"Histogram tensorboard gradients\" /></a></p>\n<p>What am I missing here? Am I logging the gradients correctly?</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 66}]