[{"items": [{"tags": ["python", "pandas", "tensorflow", "tfrecord"], "owner": {"account_id": 3948330, "reputation": 5043, "user_id": 3259896, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/641c30a7b383022f22b53c8cedb04e3f?s=256&d=identicon&r=PG&f=1", "display_name": "SantoshGupta7", "link": "https://stackoverflow.com/users/3259896/santoshgupta7"}, "is_answered": true, "view_count": 168, "accepted_answer_id": 55755724, "answer_count": 1, "score": 0, "last_activity_date": 1555640342, "creation_date": 1555631003, "last_edit_date": 1555632248, "question_id": 55754961, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/55754961/error-when-converting-string-and-array-data-from-csv-file-to-tfrecords", "title": "Error when converting string and array data from CSV file to tfrecords", "body": "<p>I am following these examples to convert my csv file to tfrecords. </p>\n\n<p>This is the code I attempted</p>\n\n<pre><code>csv = pd.read_csv(\"ehealth.csv\").values\nwith tf.python_io.TFRecordWriter(\"ehealth.tfrecords\") as writer:\n    for row in csv:\n        question, answer, question_bert, answer_bert = row[0], row[1] , row[1], row[2]\n        example = tf.train.Example()\n        example.features.feature[\"question\"].bytes_list.value.extend(question.encode(\"utf8\"))\n        example.features.feature[\"answer\"].bytes_list.value.extend(answer.encode(\"utf8\"))\n        example.features.feature[\"question_bert\"].float_list.value.extend(question_bert)\n        example.features.feature[\"answer_bert\"].float_list.value.append(answer_bert)\n        writer.write(example.SerializeToString())\n</code></pre>\n\n<p>This is my error</p>\n\n<pre><code>TypeError                                 Traceback (most recent call last) &lt;ipython-input-36-0a8c5e073d84&gt; in &lt;module&gt;()\n      4         question, answer, question_bert, answer_bert = row[0], row[1] , row[1], row[2]\n      5         example = tf.train.Example()\n----&gt; 6         example.features.feature[\"question\"].bytes_list.value.extend(question.encode(\"utf8\"))\n      7         example.features.feature[\"answer\"].bytes_list.value.extend(answer.encode(\"utf8\"))\n      8         example.features.feature[\"question_bert\"].float_list.value.extend(question_bert)\n\nTypeError: 104 has type int, but expected one of: bytes\n</code></pre>\n\n<p>It looks like there is an issue when encoding the string. I commented those two lines to make sure everything else is working correctly, </p>\n\n<pre><code>csv = pd.read_csv(\"ehealth.csv\").values\nwith tf.python_io.TFRecordWriter(\"ehealth.tfrecords\") as writer:\n    for row in csv:\n        question, answer, question_bert, answer_bert = row[0], row[1] , row[1], row[2]\n        example = tf.train.Example()\n#         example.features.feature[\"question\"].bytes_list.value.extend(question)\n#         example.features.feature[\"answer\"].bytes_list.value.extend(answer)\n        example.features.feature[\"question_bert\"].float_list.value.extend(question_bert)\n        example.features.feature[\"answer_bert\"].float_list.value.append(answer_bert)\n        writer.write(example.SerializeToString())\n</code></pre>\n\n<p>but then I get these errors</p>\n\n<pre><code>TypeError                                 Traceback (most recent call last) &lt;ipython-input-13-565b43316ef5&gt; in &lt;module&gt;()\n      6 #         example.features.feature[\"question\"].bytes_list.value.extend(question)\n      7 #         example.features.feature[\"answer\"].bytes_list.value.extend(answer)\n----&gt; 8         example.features.feature[\"question_bert\"].float_list.value.extend(question_bert)\n      9         example.features.feature[\"answer_bert\"].float_list.value.append(answer_bert)\n     10         writer.write(example.SerializeToString())\n\nTypeError: 's' has type str, but expected one of: int, long, float\n</code></pre>\n\n<p>It turns out that the issue is pandas is interpreting my array as a string instead of an array</p>\n\n<pre><code>type( csv[0][2])\n\n-&gt;str\n</code></pre>\n\n<p>Furthermore, it looks like I have to use <code>example.SerializeToString()</code> since I have an array, but not sure how to go about doing that. </p>\n\n<p>Below is the full code to reproduce the errors including code which downloads the csv file from a google drive. </p>\n\n<pre><code>import pandas as pd\nimport numpy as np\nimport requests\nimport tensorflow as tf\n\ndef download_file_from_google_drive(id, destination):\n    URL = \"https://docs.google.com/uc?export=download\"\n\n    session = requests.Session()\n\n    response = session.get(URL, params = { 'id' : id }, stream = True)\n    token = get_confirm_token(response)\n\n    if token:\n        params = { 'id' : id, 'confirm' : token }\n        response = session.get(URL, params = params, stream = True)\n\n    save_response_content(response, destination)    \n\ndef get_confirm_token(response):\n    for key, value in response.cookies.items():\n        if key.startswith('download_warning'):\n            return value\n\n    return None\n\ndef save_response_content(response, destination):\n    CHUNK_SIZE = 32768\n\n    with open(destination, \"wb\") as f:\n        for chunk in response.iter_content(CHUNK_SIZE):\n            if chunk: # filter out keep-alive new chunks\n                f.write(chunk)\n\n# download_file_from_google_drive('1rMjqKkMnt6_vROrGmlTGStNGmwPO4YFX', 'model.zip') #\n\nfile_id = '1anbEwfViu9Rzu7tWKgPb_We1EwbA4x1-'\ndestination = 'ehealth.csv'\ndownload_file_from_google_drive(file_id, destination)\n\nhealthdata=pd.read_csv('ehealth.csv')\nhealthdata.head()\n\ncsv = pd.read_csv(\"ehealth.csv\").values\nwith tf.python_io.TFRecordWriter(\"ehealth.tfrecords\") as writer:\n    for row in csv:\n        question, answer, question_bert, answer_bert = row[0], row[1] , row[1], row[2]\n        example = tf.train.Example()\n        example.features.feature[\"question\"].bytes_list.value.extend(question)\n        example.features.feature[\"answer\"].bytes_list.value.extend(answer)\n        example.features.feature[\"question_bert\"].float_list.value.extend(question_bert)\n        example.features.feature[\"answer_bert\"].float_list.value.append(answer_bert)\n        writer.write(example.SerializeToString())\n\n\ncsv = pd.read_csv(\"ehealth.csv\").values\nwith tf.python_io.TFRecordWriter(\"ehealth.tfrecords\") as writer:\n    for row in csv:\n        question, answer, question_bert, answer_bert = row[0], row[1] , row[1], row[2]\n        example = tf.train.Example()\n#         example.features.feature[\"question\"].bytes_list.value.extend(question)\n#         example.features.feature[\"answer\"].bytes_list.value.extend(answer)\n        example.features.feature[\"question_bert\"].float_list.value.extend(question_bert)\n        example.features.feature[\"answer_bert\"].float_list.value.append(answer_bert)\n        writer.write(example.SerializeToString())\n</code></pre>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 102}]