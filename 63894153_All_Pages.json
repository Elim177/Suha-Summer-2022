[{"items": [{"tags": ["python", "tensorflow", "mapping", "conv-neural-network", "tf.keras"], "owner": {"account_id": 9968983, "reputation": 2859, "user_id": 7375754, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/830f6d236ab0502a68fd9b9daf7f729f?s=256&d=identicon&r=PG&f=1", "display_name": "Jane Sully", "link": "https://stackoverflow.com/users/7375754/jane-sully"}, "is_answered": true, "view_count": 1124, "answer_count": 1, "score": 2, "last_activity_date": 1619398171, "creation_date": 1600136570, "last_edit_date": 1600141930, "question_id": 63894153, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/63894153/typeerror-tensor-object-cannot-be-interpreted-as-an-integer-when-using-tf-map", "title": "TypeError: &#39;Tensor&#39; object cannot be interpreted as an integer when using tf.map_fn()", "body": "<p>I am trying to construct label-dependent convolutional filters in keras/tensorflow. Therefore, the convolutional filter(s) depend on each example in the batch.</p>\n<pre><code># function used for tf.map_fn\ndef single_conv(tupl):\n    x, kernel = tupl\n    return tf.nn.conv2d(x, kernel, strides=(1, 1, 1, 1), padding='SAME')\n\n# first dimension is None (batch size)\ninput_img = tf.keras.layers.Input(shape=(28,28,1), dtype=tf.float32)\nlabel = tf.keras.layers.Input(shape=(10,), dtype=tf.float32) \n\n# the network is learning a mapping for the label\nlabel_encoded = tf.keras.layers.Dense(9, activation='relu')(label) \n# turn mapping into conv filter \nkernels = tf.keras.layers.Reshape((3,3,1,1))(label_encoded) \n\n# class dependent filter(s)\nconditional_conv = tf.map_fn(single_conv, (tf.expand_dims(input_img, 1), kernels), fn_output_signature=tf.float32) \n</code></pre>\n<p>When I run this code snippet, I get a <code>TypeError: 'Tensor' object cannot be interpreted as an integer</code> for the last line. Since the last line uses <code>tf.map_fn</code>, I saw that  tf.map_fn results in a TypeError if either the function used (single_conv in this case) is not callable or the structure of the output of function and fn_output_signature do not match: <a href=\"https://www.tensorflow.org/api_docs/python/tf/map_fn#raises\" rel=\"nofollow noreferrer\">https://www.tensorflow.org/api_docs/python/tf/map_fn#raises</a>.</p>\n<p>However, I'm still not sure why this is happening? I feel like both of those reasons should not be an issue?</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 0}]