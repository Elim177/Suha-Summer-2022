[{"items": [{"tags": ["python", "tensorflow", "tensorflow2.0", "tf.keras"], "owner": {"account_id": 14340604, "reputation": 44, "user_id": 10359168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b688ddfa7062a4f5537884e93c99e5e?s=256&d=identicon&r=PG", "display_name": "inorista", "link": "https://stackoverflow.com/users/10359168/inorista"}, "is_answered": false, "view_count": 85, "answer_count": 0, "score": 2, "last_activity_date": 1605149013, "creation_date": 1605149013, "question_id": 64797142, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/64797142/how-to-saveload-tf-keras-model-layer-with-extended-methods-properties", "title": "How to save&amp;load tf.keras.Model/Layer with extended methods/properties", "body": "<p>I want to extend <code>tf.keras.Model</code> to implement invertible neural networks, and save/load this model by <code>tf.keras.Model.save()</code> &amp; <code>tf.keras.models.load_model()</code></p>\n<p>Specifically, I have written two classes:</p>\n<ul>\n<li>Invertible NN class\n<ul>\n<li>subclasses <code>tf.keras.Model</code></li>\n<li>has <code>inverse()</code> method</li>\n</ul>\n</li>\n<li>Coupling layer class\n<ul>\n<li>subclasses <code>tf.keras.layers.Layer</code></li>\n<li>has <code>inverse()</code> method</li>\n<li>has <code>log_det_jacobian</code> property (<code>@property</code>).</li>\n</ul>\n</li>\n</ul>\n<p>The code related to this looks as below (please refer to <a href=\"https://github.com/w-shimaya/glow-tf2/tree/master/model\" rel=\"nofollow noreferrer\">my github repo</a> for the full code).</p>\n<pre><code>class SimpleRealNVP(K.Model):\n    ...\n    def inverse(self, inputs):\n        h = inputs\n        for layer in self.couplings:\n            h = self.layer.inverse(h)\n        return h\n    ...\n</code></pre>\n<pre><code>class AffineCoupling(L.Layer):\n    ....\n    @property\n    def log_det_jacobian(self):\n        return self._log_det_jacobian\n\n    def inverse(self, input):\n        ...\n</code></pre>\n<p>I just tried <code>tf.keras.Model.save()</code> and <code>tf.keras.load_model()</code>, but I got an error that said</p>\n<pre><code>...\nmdl = K.models.load_model(&quot;path/to/savedmodel&quot;)\n...\nx_manifold = mdl.inverse(z_manifold)\n\n# Traceback (most recent call last):\n#   File &quot;.\\manifold.py&quot;, line 54, in &lt;module&gt;\n#     x_manifold = mdl.inverse(z_manifold)\n# AttributeError: 'SimpleRealNVP' object has no attribute 'inverse'\n</code></pre>\n<p>What is the appropriate way to include extended methods/properties into the SavedModel?</p>\n<p>(I've also tried specifying <code>custom_objects</code> in <code>load_model()</code> but this didn't work.)</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 145}]