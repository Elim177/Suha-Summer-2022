[{"items": [{"tags": ["python", "tensorflow", "keras"], "owner": {"account_id": 4179598, "reputation": 326, "user_id": 7636462, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KfjtH.jpg?s=256&g=1", "display_name": "S. P", "link": "https://stackoverflow.com/users/7636462/s-p"}, "is_answered": true, "view_count": 1549, "answer_count": 1, "score": 0, "last_activity_date": 1586269102, "creation_date": 1586268305, "question_id": 61081872, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/61081872/valueerror-no-gradients-provided-for-any-variable-variable0", "title": "ValueError: No gradients provided for any variable: [&#39;Variable:0&#39;]", "body": "<p>I am trying to prepare an example notebook for showing how to create adversarial examples in TensorFlow 2.x following <a href=\"https://adversarial-ml-tutorial.org/introduction/\" rel=\"nofollow noreferrer\">this tutorial</a>. </p>\n\n<p>I have been able to port some of it but I am now stuck with a weird problem of <code>ValueError: No gradients provided for any variable: ['Variable:0'].</code> and can't seem to figure out why. </p>\n\n<p>Here's how I load the image for which I am trying to create an adversary:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>def preprocess_image(image_pixels):\n    # image_pixels = preprocess_input(image_pixels)\n    image_pixels = cv2.resize(image_pixels, (224, 224))\n    image_pixels = np.expand_dims(image_pixels, axis=0)\n\n    return image_pixels\n\n# Load and preprocess image but a but without any preprocess_input\nsample_image = show_image(\"pig.jpg\")\npreprocessed_image = preprocess_image(sample_image)\n\n# Initialize the perturbation quantity\nimage_tensor = tf.convert_to_tensor(preprocessed_image, dtype=tf.float32)\ndelta = tf.Variable(tf.zeros_like(image_tensor), trainable=True)\n</code></pre>\n\n<p>Here's how my training loop looks like - </p>\n\n<pre class=\"lang-py prettyprint-override\"><code>for t in range(30):\n    inp = preprocess_input(image_tensor + delta)\n    with tf.GradientTape() as tape:\n        tape.watch(delta)\n        pred = resnet50(inp)\n        loss = - scc_loss(\n                tf.convert_to_tensor([341]),\n                pred\n            )\n        if t % 5 == 0:\n            print(t, loss.numpy())\n\n        # Get the gradients\n        gradients = tape.gradient(loss, delta)\n\n        # Update the weights\n        optimizer.apply_gradients([(gradients, delta)])\n\n        # Clip so that the delta values are within [0,1]\n        delta.assign(clip_eps(delta))\n</code></pre>\n\n<p>where, <code>preprocess_input</code> is <code>tf.keras.applications.resnet50</code> and my model is a pre-trained ResNet50. The optimizer is defined as <code>optimizer = tf.keras.optimizers.SGD(learning_rate=1e-1)</code>. Error is listed below:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>0 -0.00041249825\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n&lt;ipython-input-284-174284e3aea4&gt; in &lt;module&gt;()\n     15 \n     16         # Update the weights\n---&gt; 17         optimizer.apply_gradients([(gradients, delta)])\n     18 \n     19         # Clip so that the delta values are within [0,1]\n\n1 frames\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/optimizer_v2/optimizer_v2.py in apply_gradients(self, grads_and_vars, name, experimental_aggregate_gradients)\n    472       ValueError: If none of the variables have gradients.\n    473     \"\"\"\n--&gt; 474     grads_and_vars = _filter_grads(grads_and_vars)\n    475     var_list = [v for (_, v) in grads_and_vars]\n    476 \n\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/keras/optimizer_v2/optimizer_v2.py in _filter_grads(grads_and_vars)\n   1201   if not filtered:\n   1202     raise ValueError(\"No gradients provided for any variable: %s.\" %\n-&gt; 1203                      ([v.name for _, v in grads_and_vars],))\n   1204   if vars_with_empty_grads:\n   1205     logging.warning(\n\nValueError: No gradients provided for any variable: ['Variable:0'].\n</code></pre>\n\n<p>Here's <a href=\"https://colab.research.google.com/drive/14WEpzKW7IHV4M08QXoTLEUX4qzfSnTB-\" rel=\"nofollow noreferrer\">where</a> the entire Colab notebook can be found. Appreciate any help/pointers. </p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 103}]