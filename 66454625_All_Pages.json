[{"items": [{"tags": ["tensorflow", "keras", "tensorflow2.x"], "owner": {"account_id": 10851289, "reputation": 602, "user_id": 7978963, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/38b8e9598b345461a481d92f9a45ba73?s=256&d=identicon&r=PG&f=1", "display_name": "Yang", "link": "https://stackoverflow.com/users/7978963/yang"}, "is_answered": true, "view_count": 323, "accepted_answer_id": 66456810, "answer_count": 1, "score": 0, "last_activity_date": 1614773508, "creation_date": 1614765314, "question_id": 66454625, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/66454625/using-condition-in-tf2-1-0-keras", "title": "Using condition in tf2.1.0-keras", "body": "<p>I am trying to using the bool condition in my own tf2.1.0-keras model, below is the simple example:</p>\n<pre><code>import tensorflow as tf\n\nclass TestKeras:\n    def __init__(self):\n        pass\n\n    def build_graph(self):\n        x = tf.keras.Input(shape=(2),batch_size=1)\n        x_value = x[0,0]\n        y = tf.cond(x_value &gt; 0, lambda :tf.add(x_value,0), lambda :tf.add(x_value,0))\n        return tf.keras.models.Model(inputs=[x], outputs=[y])\n\nif __name__ == &quot;__main__&quot;:\n    tk = TestKeras()\n    model = tk.build_graph()\n    model.summary(line_length=100)\n</code></pre>\n<p>but it seem not work and throw the exception:</p>\n<pre><code>using a `tf.Tensor` as a Python `bool` is not allowed in Graph execution. Use Eager execution or decorate this function with @tf.function.\n</code></pre>\n<p>I have try to replace the <code>tf.cond</code> with <code>tf.keras.backend.switch</code>, but it still got the same error.</p>\n<p>Also i have try to split the code <code>y = tf.cond(xxx)</code> into a single funtion and add the <code>@tf.funcion</code> decorator:</p>\n<pre><code>@tf.function\ndef compute_y(self,x):\n    return tf.cond(x &gt; 0, lambda :tf.add(x,0), lambda :tf.add(x,0))\n</code></pre>\n<p>but it got another error:</p>\n<pre><code>Inputs to eager execution function cannot be Keras symbolic tensors, but found [&lt;tf.Tensor 'strided_slice:0' shape=() dtype=float32&gt;]\n</code></pre>\n<p>Anyone knows how can condition works in tf2.1.0-keras?</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 193}]