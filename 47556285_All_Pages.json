[{"items": [{"tags": ["tensorflow"], "owner": {"account_id": 963556, "reputation": 1375, "user_id": 987397, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/fa7ae7d9bd13c2d04335c3209865c262?s=256&d=identicon&r=PG", "display_name": "Derk", "link": "https://stackoverflow.com/users/987397/derk"}, "is_answered": false, "view_count": 987, "answer_count": 1, "score": 0, "last_activity_date": 1512037506, "creation_date": 1511969228, "question_id": 47556285, "content_license": "CC BY-SA 3.0", "link": "https://stackoverflow.com/questions/47556285/tensorflow-applying-tf-boolean-mask", "title": "tensorflow applying tf.boolean_mask", "body": "<pre><code>        # Select samples from same class\n        same_match = tf.equal(match_ids, match_id)\n        same_class = tf.equal(class_ids, class_id)\n\n        positive = tf.logical_and(same_match, same_class)\n        negative = tf.logical_not(positive)\n\n        samples_pos = tf.boolean_mask(f_anchor, positive)\n        samples_neg = tf.boolean_mask(f_anchor, negative)\n</code></pre>\n\n<p>This code gives the following error:</p>\n\n<blockquote>\n  <p>ValueError: Shapes (?, 32) and (?, 1) are incompatible</p>\n</blockquote>\n\n<p>for this line:</p>\n\n<blockquote>\n  <p>line 138, in body\n      samples_pos = tf.boolean_mask(f_anchor, positive)   File \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/array_ops.py\",\n  line 1157, in boolean_mask\n      shape_tensor[:ndims_mask].assert_is_compatible_with(shape_mask)   File\n  \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/tensor_shape.py\",\n  line 753, in assert_is_compatible_with\n      raise ValueError(\"Shapes %s and %s are incompatible\" % (self, other)) ValueError: Shapes (?, 32) and (?, 1) are incompatible</p>\n</blockquote>\n\n<p>so I try to solve it with tf.squeeze:</p>\n\n<pre><code># Select samples from same class\nsame_match = tf.equal(match_ids, match_id)\nsame_class = tf.equal(class_ids, class_id)\n\npositive = tf.logical_and(same_match, same_class)\nnegative = tf.logical_not(positive)\n\nsamples_pos = tf.boolean_mask(f_anchor, tf.squeeze(positive))\nsamples_neg = tf.boolean_mask(f_anchor, tf.squeeze(negative))\n</code></pre>\n\n<p>But then the output is</p>\n\n<blockquote>\n  <p>File \"triplet.py\", line 138, in body\n      samples_pos = tf.boolean_mask(f_anchor, tf.squeeze(positive))   File\n  \"/usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/array_ops.py\",\n  line 1155, in boolean_mask\n      \"Number of mask dimensions must be specified, even if some dimensions\" ValueError: Number of mask dimensions must be specified,\n  even if some dimensions are None.  E.g. shape=[None] is ok, but\n  shape=None is not.</p>\n</blockquote>\n\n<p>What is the correct way of doing this?</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 111}]