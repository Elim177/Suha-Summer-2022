[{"items": [{"tags": ["python", "tensorflow", "deep-learning", "loss-function"], "owner": {"account_id": 16834052, "reputation": 1064, "user_id": 14337775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b79eabde913adc2731f05723397b1231?s=256&d=identicon&r=PG&f=1", "display_name": "Lawhatre", "link": "https://stackoverflow.com/users/14337775/lawhatre"}, "is_answered": false, "view_count": 118, "answer_count": 0, "score": 0, "last_activity_date": 1613290093, "creation_date": 1613290093, "question_id": 66193524, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/66193524/notfounderror-could-not-find-valid-device-for-node-in-tensorflow-for-custom-los", "title": "NotFoundError: Could not find valid device for node in TensorFlow for custom loss function on large dataset", "body": "<p>Following is my code for the custom loss function</p>\n<pre><code>def cost(self, Y, logits):\n        loss = tf.math.reduce_sum(\n            tf.nn.sparse_softmax_cross_entropy_with_logits(labels=tf.cast(Y, tf.float32), logits=tf.cast(logits, tf.float32)))\n        return loss\n</code></pre>\n<p>I'm running this on MNIST dataset. However, I got the following error.</p>\n<pre><code>File &quot;C:\\Users\\system_name\\AppData\\Roaming\\Python\\Python37\\site-packages\\tensorflow_core\\python\\ops\\gen_nn_ops.py&quot;, line 11838, in sparse_softmax_cross_entropy_with_logits                                                                                                                                                   \n    _six.raise_from(_core._status_to_exception(e.code, message), None)                                                                                         \n  File &quot;&lt;string&gt;&quot;, line 3, in raise_from                                                                                                                       \ntensorflow.python.framework.errors_impl.NotFoundError: Could not find valid device for node.                                                                   \nNode:{{node SparseSoftmaxCrossEntropyWithLogits}}                                                                                                              \nAll kernels registered for op SparseSoftmaxCrossEntropyWithLogits :                                                                                            \n  device='CPU'; T in [DT_FLOAT]; Tlabels in [DT_INT32]                                                                                                         \n  device='CPU'; T in [DT_FLOAT]; Tlabels in [DT_INT64]                                                                                                         \n  device='CPU'; T in [DT_DOUBLE]; Tlabels in [DT_INT32]                                                                                                        \n  device='CPU'; T in [DT_DOUBLE]; Tlabels in [DT_INT64]                                                                                                        \n  device='CPU'; T in [DT_HALF]; Tlabels in [DT_INT32]                                                                                                          \n  device='CPU'; T in [DT_HALF]; Tlabels in [DT_INT64]                                                                                                          \n  device='GPU'; T in [DT_FLOAT]; Tlabels in [DT_INT32]                                                                                                         \n  device='GPU'; T in [DT_FLOAT]; Tlabels in [DT_INT64]                                                                                                         \n  device='GPU'; T in [DT_HALF]; Tlabels in [DT_INT32]                                                                                                          \n  device='GPU'; T in [DT_HALF]; Tlabels in [DT_INT64]                                                                                                          \n [Op:SparseSoftmaxCrossEntropyWithLogits]                                                                                                                      \n[Finished in 27.01s with exit code 1]\n</code></pre>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 206}]