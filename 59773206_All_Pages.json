[{"items": [{"tags": ["python", "numpy", "tensorflow", "h5py"], "owner": {"account_id": 4441934, "reputation": 1952, "user_id": 3616293, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/cf7556b4227065cec9496375d64fea3d?s=256&d=identicon&r=PG&f=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/3616293/arun"}, "is_answered": false, "view_count": 798, "answer_count": 0, "score": 0, "last_activity_date": 1579193859, "creation_date": 1579189402, "last_edit_date": 1579193859, "question_id": 59773206, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/59773206/writing-python-list-as-hdf5-file-using-h5py-module", "title": "Writing Python list as HDF5 file using h5py module", "body": "<p>I have created a Python list containing random values created using TensorFlow 2.0 which I then want to save as HDF5 file using \"h5py\" module in Python.</p>\n\n<p>The code I am using is as follows-</p>\n\n<pre><code># list to hold values-\nwts_extracted = []\n\nwts_extracted.append(tf.cast(tf.random.normal(shape = (4, 4), mean = 0, stddev = 1), dtype=tf.float32))\nwts_extracted.append(tf.cast(tf.random.normal(shape = (4,), mean = 0, stddev = 1), dtype=tf.float32))\nwts_extracted.append(tf.cast(tf.random.normal(shape = (4, 3), mean = 0, stddev = 1), dtype=tf.float32))\nwts_extracted.append(tf.cast(tf.random.normal(shape = (3, ), mean = 0, stddev = 1), dtype=tf.float32))\nwts_extracted.append(tf.cast(tf.random.normal(shape = (3, 1), mean = 0, stddev = 1), dtype=tf.float32))\nwts_extracted.append(tf.cast(tf.random.normal(shape = (1, ), mean = 0, stddev = 1), dtype=tf.float32))\n\n# Convert Python list to numpy array-\nn = np.array(wts_extracted)\n\nn.shape\n# (6,)\n\ntype(n)\n# numpy.ndarray\n\n# Save manually created weights as '.h5' file-\nwith h5py.File(\"manually_created_weights.h5\", \"w\") as f:\n    dset = f.create_dataset(\"default\", data = n)\n</code></pre>\n\n<p>The error message I get is:</p>\n\n<blockquote>\n  <p>TypeError                                 Traceback (most recent call\n  last)  in \n        1 with h5py.File(\"manually_created_weights.h5\", \"w\") as f:\n  ----> 2         dset = f.create_dataset(\"default\", data = n)</p>\n  \n  <p>~/.local/lib/python3.7/site-packages/h5py/_hl/group.py in\n  create_dataset(self, name, shape, dtype, data, **kwds)\n      134 \n      135         with phil:\n  --> 136             dsid = dataset.make_new_dset(self, shape, dtype, data, **kwds)\n      137             dset = dataset.Dataset(dsid)\n      138             if name is not None:</p>\n  \n  <p>~/.local/lib/python3.7/site-packages/h5py/_hl/dataset.py in\n  make_new_dset(parent, shape, dtype, data, chunks, compression,\n  shuffle, fletcher32, maxshape, compression_opts, fillvalue,\n  scaleoffset, track_times, external, track_order, dcpl)\n      116         else:\n      117             dtype = numpy.dtype(dtype)\n  --> 118         tid = h5t.py_create(dtype, logical=1)\n      119 \n      120     # Legacy</p>\n  \n  <p>h5py/h5t.pyx in h5py.h5t.py_create()</p>\n  \n  <p>h5py/h5t.pyx in h5py.h5t.py_create()</p>\n  \n  <p>h5py/h5t.pyx in h5py.h5t.py_create()</p>\n  \n  <p>TypeError: Object dtype dtype('O') has no native HDF5 equivalent</p>\n</blockquote>\n\n<p>I read that in order to use \"h5py\" module, you should convert Pythonic objects to numpy arrays, which I did. What's going wrong?</p>\n\n<p>Thanks!</p>\n\n<p>EDIT:</p>\n\n<p>\"h5py\" cannot handle different shapes/dimensions, hence, I have the following code:</p>\n\n<pre><code># Save the different shape arrays as separate datasets:\n\n# Python dict-\nwts_extracted_dict = {}\n\nl = 0\n\nwhile l &lt; len(wts_extracted):\n    wts_extracted_dict['layer-{0}'.format(l)] = wts_extracted[l]\n    l += 1\n\n\n# Create '.h5' file on HDD-\nf = h5py.File(\"manual_weights.h5\", \"w\")\n\n# Create a group-\ngrp = f.create_group(\"alist\")\n\nfor k, v in wts_extracted_dict.items():\n    grp.create_dataset(k, data=v)\n\ngrp\n# &lt;HDF5 group \"/alist\" (6 members)&gt;\n\nf.close()\n</code></pre>\n\n<p>However, when I try to read the saved file and access the groups as follows:</p>\n\n<pre><code>f = h5py.File(\"manual_weights.h5\", \"r\")\n\nf.keys()\n# &lt;KeysViewHDF5 ['alist']&gt;\n\nf['alist']\n# &lt;HDF5 group \"/alist\" (6 members)&gt;\n\ntype(f['alist'])\n# h5py._hl.group.Group\n</code></pre>\n\n<p>How do I access the group?</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 14}]