[{"items": [{"tags": ["python", "tensorflow", "keras"], "owner": {"account_id": 2579637, "reputation": 157, "user_id": 2236600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c003cc2d7f11c8bff67e5e5cc52e6d4?s=256&d=identicon&r=PG", "display_name": "user2236600", "link": "https://stackoverflow.com/users/2236600/user2236600"}, "is_answered": true, "view_count": 171, "accepted_answer_id": 59660426, "answer_count": 1, "score": 1, "last_activity_date": 1578560733, "creation_date": 1578535116, "last_edit_date": 1578540211, "question_id": 59656219, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/59656219/override-tf-floor-gradient", "title": "Override tf.floor gradient", "body": "<p>I tried to use tf.floor in my output layer, but keep getting \"None gradient\" error even if I tried to override it with identity gradient.</p>\n\n<pre><code>import tensorflow as tf\nfrom tensorflow import keras\n\ndef transfer(x):\n    with tf.compat.v1.get_default_graph() as g:\n        with g.gradient_override_map({'Floor': 'Identity'})\n            return tf.floor(x * 90) / 90\n\ninput = keras.layers.Input((10, ))\noutput = keras.layers.Lambda(transfer)(keras.layers.Dense(1, activation='sigmoid')(input))\n</code></pre>\n\n<p>Here is the full error message:</p>\n\n<pre><code>/tensorflow-2.1.0/python3.6/tensorflow_core/python/keras/optimizer_v2/optimizer_v2.py in _filter_grads(grads_and_vars)\n   1037   if not filtered:\n   1038     raise ValueError(\"No gradients provided for any variable: %s.\" %\n-&gt; 1039                      ([v.name for _, v in grads_and_vars],))\n   1040   if vars_with_empty_grads:\n   1041     logging.warning(\n\nValueError: No gradients provided for any variable:\n</code></pre>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 94}]