[{"items": [{"tags": ["tensorflow", "tensorflow-estimator"], "owner": {"account_id": 8798611, "reputation": 433, "user_id": 6575669, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/7bd481bcde73bb91cce36780635b423d?s=256&d=identicon&r=PG&f=1", "display_name": "prateek agrawal", "link": "https://stackoverflow.com/users/6575669/prateek-agrawal"}, "is_answered": true, "view_count": 817, "accepted_answer_id": 55658125, "answer_count": 1, "score": 0, "last_activity_date": 1555158248, "creation_date": 1555095409, "last_edit_date": 1555108370, "question_id": 55657952, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/55657952/creating-custom-metrics-in-tensorflow-estimators", "title": "Creating custom metrics in tensorflow estimators", "body": "<p>I am training a classification problem using tensorflow estimators.</p>\n\n<p>I want to calculate the f1 score for each batch to data along with precision and recall.</p>\n\n<p>I calculate precision and recall using the code below and log them for evaluation and training.</p>\n\n<p>I also calculate the fscore using the formula, but while logging the fscore I get an error.</p>\n\n<pre><code>pre = tf.metrics.precision(labels=labels,predictions=pred,name=\"precision\")\n\nrec = tf.metrics.recall(labels=labels,predictions=pred,name=\"recall\")\n\nfscore_val = tf.reduce_mean((2*pre[0]*rec[0]) / (pre[0] + rec[0] + 1e-5))\nfscore_update = tf.group(pre[1], rec[1])\n\nfscore = (fscore_val, fscore_update)\n\n# logging metric at evaluation time\nmetrics['precision'] = pre                    \nmetrics['recall'] = rec\nmetrics['fscore'] = fscore \n\n# logging metric at training time                   \ntf.summary.scalar('precision', pre[1])\ntf.summary.scalar('recall', rec[1])\ntf.summary.scalar('fscore', fscore)\n\n\n</code></pre>\n\n<p>This is the error that I get.</p>\n\n<pre><code>TypeError: Expected float32, got &lt;tf.Operation 'metrics_Left_Lane_Type/group_deps' type=NoOp&gt; of type 'Operation' instead.\n\n</code></pre>\n\n<p>I understand why I am getting this error.\nIt is because fscore should be two values, similar to precision and recall.</p>\n\n<p>Can someone please help me on how to do this in tensorflow estimators?</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 270}]