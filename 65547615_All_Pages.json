[{"items": [{"tags": ["python", "tensorflow"], "owner": {"account_id": 16705366, "reputation": 1, "user_id": 14693976, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LHvRF.png?s=256&g=1", "display_name": "schissmantics", "link": "https://stackoverflow.com/users/14693976/schissmantics"}, "is_answered": false, "view_count": 916, "answer_count": 1, "score": 0, "last_activity_date": 1609690116, "creation_date": 1609659276, "question_id": 65547615, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/65547615/how-to-create-variables-inside-tf-function-decorated-method", "title": "How to create variables inside tf.function decorated method?", "body": "<p>Cannot create a <code>tf.Variable</code> (while I should) in a <code>tf.function</code> decorated method:</p>\n<pre><code>@tf.function\ndef some_func():\n    x = tf.Variable([1, 2, 3])\n</code></pre>\n<p>I get:</p>\n<pre><code>/usr/local/lib/python3.8/site-packages/tensorflow/python/ops/variables.py:262 __call__  **\n    return cls._variable_v2_call(*args, **kwargs)\n/usr/local/lib/python3.8/site-packages/tensorflow/python/ops/variables.py:244 _variable_v2_call\n    return previous_getter(\n/usr/local/lib/python3.8/site-packages/tensorflow/python/ops/variables.py:67 getter\n    return captured_getter(captured_previous, **kwargs)\n/usr/local/lib/python3.8/site-packages/tensorflow/python/eager/def_function.py:716 invalid_creator_scope\n    raise ValueError(\n\nValueError: tf.function-decorated function tried to create variables on non-first call.\n</code></pre>\n<p>I think there is some workaround using:</p>\n<pre><code>tf.config.experimental_run_functions_eagerly(True)\n</code></pre>\n<p>but I also think that it affects performance, which the whole point of <code>tf.function</code> in the first place.</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 238}]