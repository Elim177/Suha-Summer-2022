[{"items": [{"tags": ["python", "tensorflow", "tensorflow-datasets"], "owner": {"account_id": 10716056, "reputation": 2138, "user_id": 7886651, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/zfb59.jpg?s=256&g=1", "display_name": "I. A", "link": "https://stackoverflow.com/users/7886651/i-a"}, "is_answered": true, "view_count": 57, "accepted_answer_id": 53087861, "answer_count": 1, "score": 0, "last_activity_date": 1541002630, "creation_date": 1540995448, "last_edit_date": 1540996579, "question_id": 53085509, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/53085509/running-the-model-on-the-development-dataset-after-restoring-the-model-while-usi", "title": "Running the model on the development dataset after restoring the model while using tf.data.Dataset api in tensorflow", "body": "<p>I have trained my model in tensorflow while using the tf.data.Dataset api in tensorflow. I would like to demonstrate some parts of my code:</p>\n\n<pre><code># This corresponds to loading the data using the tf.data.Dataset api...\nnames_train, detected_train, arousal_train, valence_train, liking_train, is_talking_train, images_train,\\\niterator_train_all = load_train_sewa_tfrecords(filenames_train, train_batch_size)\n\nnames_devel, detected_devel, arousal_devel, valence_devel, liking_devel, is_talking_devel, images_devel, \\\niterator_dev_all = load_devel_sewa_tfrecords(filenames_dev, test_batch_size)\n</code></pre>\n\n<p>Now, I have seen that training and testing the model should be done by creating the model and then reusing it for testing. So:</p>\n\n<pre><code>train_predictions, model_layers_name_shape = simpler_CNN(images_train, my_initializer, phase_train, dropout,\n                                                         dopout_per_call_bool, mseed, reuse=False)\n\ndevel_predictions, _ = simpler_CNN(images_devel, my_initializer, phase_train, dropout, dopout_per_call_bool,\n                                   mseed, reuse=True)\n</code></pre>\n\n<p>Now, here is my problem: when creating the model, I have passed the training dataset images as inputs to the model. On the other hand, when it comes to extracting certain features from the model given the testing dataset, tensorflow will ask me to initialize the training iterator because it assumes I am feeding the training dataset (given how I created the model <strong>\"i.e. I have passed the training images as input to the model where the reuse was False\"</strong>).</p>\n\n<p>Now I have tried using a condition as follows:</p>\n\n<pre><code># the train_dataset will tell whether we are using the training or the testing dataset\ntrain_dataset = tf.placeholder(dtype=tf.bool, shape=(), name='train_dataset')\nimages = tf.cond(train_dataset, return_images_train, return_images_devel)\n\n# and then passing the images to the simpler_CNN while reuse is False:\ntrain_predictions, model_layers_name_shape = simpler_CNN(images, my_initializer, phase_train, dropout,\n                                                     dopout_per_call_bool, mseed, reuse=False)\n</code></pre>\n\n<p>Yet, this does not solve the problem and tensorflow will still ask me to initialize the training iterator. </p>\n\n<p>Furthermore, if I run initialize both the training and the testing iterators, then run the model on the testing dataset till the end; now, If I try feeding the training dataset, I will get <code>End of sequence</code> on the training iterator <em>as if the training iterator was running also while feeding the testing dataset</em> (this behavior is weird for me).</p>\n\n<p>In conclusion, how can I tell the model that I would like to load the testing dataset? Also, note that I can run <code>devel_prediction</code> and tensorflow will know what I am talking about, but running a hidden layer in the model will create the problem.</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 67}]