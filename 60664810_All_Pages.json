[{"items": [{"tags": ["tensorflow", "keras", "gradient", "tensorflow2.0"], "owner": {"account_id": 10879163, "reputation": 11, "user_id": 7998707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b5c7d888438bb5e714d1c2f779d0cf1?s=256&d=identicon&r=PG&f=1", "display_name": "NGH\u0128A V\u0168 \u0110\u1ee8C", "link": "https://stackoverflow.com/users/7998707/ngh%c4%a8a-v%c5%a8-%c4%90%e1%bb%a8c"}, "is_answered": false, "view_count": 146, "answer_count": 1, "score": 1, "last_activity_date": 1584428367, "creation_date": 1584073175, "question_id": 60664810, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/60664810/in-tensorflow-2-0-with-eager-execution-how-to-compute-the-gradients-of-a-networ", "title": "In TensorFlow 2.0 with eager-execution, how to compute the gradients of a network output wrt input layer?", "body": "<p>I use network InceptionV3, I want to compute the gradients of the model output w.r.t. the input layer. I have the following code:</p>\n\n<pre><code>origin_image = load_img(\"dog.jpg\", target_size=(299, 299))\norigin_image = img_to_array(origin_image)\norigin_image = (origin_image - 127.5) / 127.5\norigin_image = np.expand_dims(origin_image, axis=0)\n\nmodel = tensorflow.keras.applications.inception_v3.InceptionV3()\n\nwith tf.GradientTape() as gtape:\n   output = model(origin_image)\n   y_pred = output[0, 346]\n\ngradient = gtape.gradient(y_pred, model.get_layer(\"input_1\").trainable_variables)\nprint(gradient) # return []\n</code></pre>\n\n<p>but this code is running: </p>\n\n<pre><code>from keras import backend as K\n\nmodel_input_layer = model.layers[0].input\nmodel_output_layer = model.layers[-1].output\n\ncost_function = model_output_layer[0, 346]\ngradient_function = K.gradients(cost_function, model_input_layer)\ngrab_cost_and_gradients_from_model = K.function([model_input_layer, K.learning_phase()],\n                                                [cost_function, gradient_function])\n\ncost, gradients = grab_cost_and_gradients_from_model([origin_image, 0])\n</code></pre>\n\n<p>How can tf.GradientTape be used to calculate the gradient of the output with respect to the input</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 65}]