[{"items": [{"tags": ["python", "tensorflow2.0"], "owner": {"account_id": 8234428, "reputation": 3654, "user_id": 6194150, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/VKEyy.jpg?s=256&g=1", "display_name": "Alexander", "link": "https://stackoverflow.com/users/6194150/alexander"}, "is_answered": true, "view_count": 471, "accepted_answer_id": 62950457, "answer_count": 2, "score": 1, "last_activity_date": 1632240366, "creation_date": 1594974873, "question_id": 62950167, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/62950167/why-loss-function-is-inside-tf-gradienttape-block-and-gradients-calculation-is-o", "title": "Why loss function is inside tf.GradientTape block and gradients calculation is outside?", "body": "<p>I am new in <code>Tensorflow</code>. In the textbook example I saw the following code designed to train simple linear model using <code>Tensorflow 2.x</code> API:</p>\n<pre><code>m = tf.Variable(0.)\nb = tf.Variable(0.)\ndef predict_y_value(x):\n    y = m * x + b\n    return y\ndef squared_error(y_pred, y_true):\n    return tf.reduce_mean(tf.square(y_pred - y_true))\nlearning_rate = 0.05\nsteps = 500\nfor i in range(steps):\n    with tf.GradientTape() as tape:\n        predictions = predict_y_value(x_train)\n        loss = squared_error(predictions, y_train)\n    gradients = tape.gradient(loss, [m, b])\n    m.assign_sub(gradients[0] * learning_rate)\n    b.assign_sub(gradients[1] * learning_rate)\nprint (&quot;m: %f, b: %f&quot; % (m.numpy(), b.numpy()))\n</code></pre>\n<p>Why it is necessary to include the definition of loss function into the block <code>with tf.GradientTape() as tape</code> , but <code>gradients = tape.gradient(loss, [m, b])</code> code line is outside <code>with</code> block?</p>\n<p>I understand that it may be <code>Python</code> language specific, but this construction seems unclear to me. What is the role of <code>Python</code> context manager here?</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 35}]