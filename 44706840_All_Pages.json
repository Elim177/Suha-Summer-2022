[{"items": [{"tags": ["tensorflow", "tensorboard"], "owner": {"user_type": "does_not_exist", "display_name": "user5586747"}, "is_answered": true, "view_count": 5566, "answer_count": 3, "score": 8, "last_activity_date": 1503544347, "creation_date": 1498155824, "last_edit_date": 1503516332, "question_id": 44706840, "content_license": "CC BY-SA 3.0", "link": "https://stackoverflow.com/questions/44706840/tensorflow-summery-merge-error-shape-1-784-has-negative-dimensions", "title": "Tensorflow summery merge error : Shape [-1,784] has negative dimensions", "body": "\n\n<p>I am trying to get summary of a training process of the neural net below.</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>import tensorflow as tf \nimport numpy as np \n\nfrom tensorflow.examples.tutorials.mnist import input_data\n\nmnist = input_data.read_data_sets(\".\\MNIST\",one_hot=True)\n\n# Create the model\ndef train_and_test(hidden1,hidden2, learning_rate, epochs, batch_size):\n\n    with tf.name_scope(\"first_layer\"):\n        input_data = tf.placeholder(tf.float32, [batch_size, 784], name = \"input\")\n        weights1  = tf.Variable(\n        tf.random_normal(shape =[784, hidden1],stddev=0.1),name = \"weights\")\n        bias = tf.Variable(tf.constant(0.0,shape =[hidden1]), name = \"bias\")\n        activation = tf.nn.relu(\n        tf.matmul(input_data, weights1) + bias, name = \"relu_act\")\n        tf.summary.histogram(\"first_activation\", activation)\n\n    with tf.name_scope(\"second_layer\"):\n        weights2  = tf.Variable(\n        tf.random_normal(shape =[hidden1, hidden2],stddev=0.1),\n        name = \"weights\")\n        bias2 = tf.Variable(tf.constant(0.0,shape =[hidden2]), name = \"bias\")\n        activation2 = tf.nn.relu(\n        tf.matmul(activation, weights2) + bias2, name = \"relu_act\")\n        tf.summary.histogram(\"second_activation\", activation2)\n\n    with tf.name_scope(\"output_layer\"):\n        weights3 = tf.Variable(\n            tf.random_normal(shape=[hidden2, 10],stddev=0.5), name = \"weights\")\n        bias3 = tf.Variable(tf.constant(1.0, shape =[10]), name = \"bias\")\n        output = tf.add(\n        tf.matmul(activation2, weights3, name = \"mul\"), bias3, name = \"output\")\n        tf.summary.histogram(\"output_activation\", output)\n    y_ = tf.placeholder(tf.float32, [batch_size, 10])\n\n    with tf.name_scope(\"loss\"):\n        cross_entropy = tf.reduce_mean(\n        tf.nn.softmax_cross_entropy_with_logits(labels=y_, logits=output))\n        tf.summary.scalar(\"cross_entropy\", cross_entropy)\n    with tf.name_scope(\"train\"):\n        train_step = tf.train.GradientDescentOptimizer(learning_rate).minimize(cross_entropy)\n\n    with tf.name_scope(\"tests\"):\n        correct_prediction = tf.equal(tf.argmax(output, 1), tf.argmax(y_, 1))\n        accuracy = tf.reduce_mean(tf.cast(correct_prediction, tf.float32))\n\n    summary_op = tf.summary.merge_all()\n\n    sess = tf.InteractiveSession()\n    writer = tf.summary.FileWriter(\"./data\", sess.graph)\n    tf.global_variables_initializer().run()\n\n    # Train\n    for i in range(epochs):\n        batch_xs, batch_ys = mnist.train.next_batch(batch_size)\n         _, summary = sess.run([train_step,summary_op], feed_dict={input_data: batch_xs, y_: batch_ys})\n     writer.add_summary(summary)\n\n     if i % 10 ==0:\n          test_xs, test_ys = mnist.train.next_batch(batch_size)\n          test_accuracy = sess.run(accuracy, feed_dict = {input_data : test_xs, y_ : test_ys})\n    writer.close()\n    return test_accuracy\n\nif __name__ ==\"__main__\":\nprint(train_and_test(500, 200, 0.001, 10000, 100))\n</code></pre>\n\n<p>I am testing the model every 10 step with a random batch of test data.\nThe problem is in the summery writer. The sess.run() inside the for loop throws following error.</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>    Traceback (most recent call last):\n\n  File \"&lt;ipython-input-18-78c88c8e6471&gt;\", line 1, in &lt;module&gt;\n    runfile('C:/Users/Suman \nNepal/Documents/Projects/MNISTtensorflow/mnist.py', wdir='C:/Users/Suman \nNepal/Documents/Projects/MNISTtensorflow')\n\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-\npackages\\spyder\\utils\\site\\sitecustomize.py\", line 880, in runfile\nexecfile(filename, namespace)\n\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-\npackages\\spyder\\utils\\site\\sitecustomize.py\", line 102, in execfile\nexec(compile(f.read(), filename, 'exec'), namespace)\n\n  File \"C:/Users/Suman Nepal/Documents/Projects/MNISTtensorflow/mnist.py\", line 68, in &lt;module&gt;\n    print(train_and_test(500, 200, 0.001, 100, 100))\n\n  File \"C:/Users/Suman Nepal/Documents/Projects/MNISTtensorflow/mnist.py\", line 58, in train_and_test\n    _, summary = sess.run([train_step,summary_op], feed_dict={input_data: batch_xs, y_: batch_ys})\n\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 789, in run\n    run_metadata_ptr)\n\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 997, in _run\nfeed_dict_string, options, run_metadata)\n\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1132, in _do_run\ntarget_list, options, run_metadata)\n\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\client\\session.py\", line 1152, in _do_call\nraise type(e)(node_def, op, message)\n\nInvalidArgumentError: Shape [-1,784] has negative dimensions\n [[Node: first_layer_5/input = Placeholder[dtype=DT_FLOAT, shape=[?,784], _device=\"/job:localhost/replica:0/task:0/cpu:0\"]()]]\n\nCaused by op 'first_layer_5/input', defined at:\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\spyder\\utils\\ipython\\start_kernel.py\", line 231, in &lt;module&gt;\nmain()\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\spyder\\utils\\ipython\\start_kernel.py\", line 227, in main\nkernel.start()\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\ipykernel\\kernelapp.py\", line 477, in start\nioloop.IOLoop.instance().start()\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\zmq\\eventloop\\ioloop.py\", line 177, in start\nsuper(ZMQIOLoop, self).start()\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\tornado\\ioloop.py\", line 888, in start\nhandler_func(fd_obj, events)\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\tornado\\stack_context.py\", line 277, in null_wrapper\nreturn fn(*args, **kwargs)\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\zmq\\eventloop\\zmqstream.py\", line 440, in _handle_events\nself._handle_recv()\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\zmq\\eventloop\\zmqstream.py\", line 472, in _handle_recv\nself._run_callback(callback, msg)\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\zmq\\eventloop\\zmqstream.py\", line 414, in _run_callback\ncallback(*args, **kwargs)\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\tornado\\stack_context.py\", line 277, in null_wrapper\nreturn fn(*args, **kwargs)\n File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 283, in dispatcher\nreturn self.dispatch_shell(stream, msg)\n File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 235, in dispatch_shell\nhandler(stream, idents, msg)\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\ipykernel\\kernelbase.py\", line 399, in execute_request\nuser_expressions, allow_stdin)\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\ipykernel\\ipkernel.py\", line 196, in do_execute\nres = shell.run_cell(code, store_history=store_history, silent=silent)\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\ipykernel\\zmqshell.py\", line 533, in run_cell\nreturn super(ZMQInteractiveShell, self).run_cell(*args, **kwargs)\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2717, in run_cell\ninteractivity=interactivity, compiler=compiler, result=result)\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2827, in run_ast_nodes\nif self.run_code(code, result):\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\IPython\\core\\interactiveshell.py\", line 2881, in run_code\nexec(code_obj, self.user_global_ns, self.user_ns)\n  File \"&lt;ipython-input-8-78c88c8e6471&gt;\", line 1, in &lt;module&gt;\nrunfile('C:/Users/Suman Nepal/Documents/Projects/MNISTtensorflow/mnist.py', wdir='C:/Users/Suman Nepal/Documents/Projects/MNISTtensorflow')\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\spyder\\utils\\site\\sitecustomize.py\", line 880, in runfile\nexecfile(filename, namespace)\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\spyder\\utils\\site\\sitecustomize.py\", line 102, in execfile\nexec(compile(f.read(), filename, 'exec'), namespace)\n  File \"C:/Users/Suman Nepal/Documents/Projects/MNISTtensorflow/mnist.py\", line 86, in &lt;module&gt;\n  File \"C:/Users/Suman Nepal/Documents/Projects/MNISTtensorflow/mnist.py\", line 12, in train_and_test\n   input_data = tf.placeholder(tf.float32, [None, 784], name = \"input\")\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\ops\\array_ops.py\", line 1530, in placeholder\nreturn gen_array_ops._placeholder(dtype=dtype, shape=shape, name=name)\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\ops\\gen_array_ops.py\", line 1954, in _placeholder\nname=name)\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\framework\\op_def_library.py\", line 767, in apply_op\nop_def=op_def)\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 2506, in create_op\noriginal_op=self._default_original_op, op_def=op_def)\n  File \"C:\\Users\\Suman Nepal\\Anaconda3\\lib\\site-packages\\tensorflow\\python\\framework\\ops.py\", line 1269, in __init__\nself._traceback = _extract_stack()\n\nInvalidArgumentError (see above for traceback): Shape [-1,784] has negative dimensions\n     [[Node: first_layer_5/input = Placeholder[dtype=DT_FLOAT, shape=[?,784], _device=\"/job:localhost/replica:0/task:0/cpu:0\"]()]]\n</code></pre>\n\n<p>If I deleted all the summary writers and summary, the model runs fine.\nCan you help me spot the problem here? I tried manipulating the shapes of tensors but got nowhere.</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 106}]