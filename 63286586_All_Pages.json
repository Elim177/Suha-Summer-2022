[{"items": [{"tags": ["python", "tensorflow", "tensorflow-probability"], "owner": {"account_id": 7928975, "reputation": 53, "user_id": 5987508, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f03182fdc66a1a2151c0290cb8a5a9f?s=256&d=identicon&r=PG&f=1", "display_name": "M-P", "link": "https://stackoverflow.com/users/5987508/m-p"}, "is_answered": true, "view_count": 291, "accepted_answer_id": 63566024, "answer_count": 2, "score": 1, "last_activity_date": 1598290605, "creation_date": 1596726732, "question_id": 63286586, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/63286586/tensorflow-probability-bijector-training", "title": "Tensorflow probability - Bijector training", "body": "<p>I have been trying to follow the example from this <a href=\"https://blog.evjang.com/2018/01/nf1.html\" rel=\"nofollow noreferrer\">tutorial</a>, but I am having trouble training any of the variables.</p>\n<p>I wrote a small example, but I haven't been able to make that work either:</p>\n<pre><code># Train a shift bijector\nshift = tf.Variable(initial_value=tf.convert_to_tensor([1.0], dtype=tf.float32), trainable=True, name='shift_var')\nbijector = tfp.bijectors.Shift(shift=shift)\n\n# Input\nx = tf.convert_to_tensor(np.array([0]), dtype=tf.float32)\ntarget = tf.convert_to_tensor(np.array([2]), dtype=tf.float32)\n\noptimizer = tf.optimizers.Adam(learning_rate=0.5)\nnsteps = 1\n\nprint(bijector(x).numpy(), bijector.shift)\nfor _ in range(nsteps):\n\n    with tf.GradientTape() as tape:\n        out = bijector(x)\n        loss = tf.math.square(tf.math.abs(out - target))\n        #print(out, loss)\n    \n        gradients = tape.gradient(loss, bijector.trainable_variables)\n    \n    optimizer.apply_gradients(zip(gradients, bijector.trainable_variables))\n    \nprint(bijector(x).numpy(), bijector.shift)\n</code></pre>\n<p>For nsteps = 1, the two print statements result in the following output:</p>\n<pre><code>[1.] &lt;tf.Variable 'shift_var:0' shape=(1,) dtype=float32, numpy=array([1.], dtype=float32)&gt;\n[1.] &lt;tf.Variable 'shift_var:0' shape=(1,) dtype=float32, numpy=array([1.4999993], dtype=float32)&gt;\n\n</code></pre>\n<p>It seems like the <code>bijector</code> still uses the original <code>shift</code> even though the printed value of <code>bijector.shift</code> has been updated.</p>\n<p>I cannot increase <code>nsteps</code> as the gradient is <code>None</code> after the first iteration, and I got this error:</p>\n<pre><code>ValueError: No gradients provided for any variable: ['shift_var:0'].\n</code></pre>\n<p>I'm using</p>\n<pre><code>tensorflow version 2.3.0\ntensorflow-probability version 0.11.0\n</code></pre>\n<p>I also tried it on a colab notebook, so I doubt it's a version problem.</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 275}]