[{"items": [{"tags": ["python", "tensorflow", "deep-learning", "tensorflow2.0"], "owner": {"account_id": 16619414, "reputation": 1, "user_id": 12010225, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-GGR5BGKJtfU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdHk7UNyZaFSiqe62ixBAwj05dqqw/photo.jpg?sz=256", "display_name": "PAD", "link": "https://stackoverflow.com/users/12010225/pad"}, "is_answered": false, "view_count": 164, "answer_count": 0, "score": 0, "last_activity_date": 1582300484, "creation_date": 1582287578, "last_edit_date": 1582300484, "question_id": 60338544, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/60338544/i-got-this-error-by-upgrading-to-tensorflow-2-1-attributeerror-operation-ob", "title": "I got This error by upgrading to TensorFlow 2.1: &quot;AttributeError: &#39;Operation&#39; object has no attribute &#39;_graph&#39;&quot;", "body": "<p>My code is written under TensorFlow 2.0 and I run it on Ubuntu 18.04.04. The code is perfectly run with TensorFlow 2.0. But I need to use TensorFlow 2.1 because of some functionality of the TensorFlow_addones library. I upgrade the Tensorflow within my virtual environment by the command \"conda install TensorFlow-gpu\" and run the code. The code runs for the first epoch and saves the result but as soon as it starts next epoch, it stop and show this error.\nIf I downgrade the TensorFlow to 2.0, again the code run without any problem. Does anybody know what is the issue?\nThe problem is on CPU and GPU.</p>\n\n<pre><code>enter code here\n\n\nwith tf.GradientTape() as tape:\n    with tf.name_scope('setup'):\n        psv_planes = inv_depths(min_depth, max_depth, num_psv_planes)\n        mpi_planes = inv_depths(min_depth, max_depth, num_psv_planes)\n\n        if frame == 'up':\n            c_u = tf.expand_dims(sample[2][:int(.6 * img_height), :, :], axis=0)\n            u1 = tf.expand_dims(sample[0], axis=0)\n            u2 = tf.expand_dims(sample[3], axis=0)\n        elif frame == 'low':\n            c_l = tf.expand_dims(sample[2][-int(.6 * img_height):, :, :], axis=0)\n            l1 = tf.expand_dims(sample[1], axis=0)\n            l2 = tf.expand_dims(sample[4], axis=0)\n\n    with tf.name_scope('model'):\n        if frame == 'up':\n            input_u = format_net_input(u1, u2, psv_planes, intrin_pos['pose_u2'], intrin_pos['pose_u1'],\n                                       intrin_pos['intrinsics'])\n            net_output_u = model(input_u)\n            output = synthesize(net_output_u, u1, intrin_pos['pose_target'], mpi_planes, intrin_pos['intrinsics'])\n        elif frame == 'low':\n            input_l = format_net_input(l1, l2, psv_planes, intrin_pos['pose_l2'], intrin_pos['pose_l1'],\n                                       intrin_pos['intrinsics'])\n            net_output_l = model(input_l)\n            output = synthesize(net_output_l, l1, intrin_pos['pose_target'], mpi_planes, intrin_pos['intrinsics'])\n\n    with tf.name_scope('loss'):\n        if frame == 'up':\n            loss = tf.reduce_mean(tf.nn.l2_loss(output[:, :, :, :] - c_u[:, :, :, :]))\n            print('upper loss is:{}'.format(loss))\n        elif frame == 'low':\n            loss = tf.reduce_mean(tf.nn.l2_loss(output[:, :, :, :] - c_l[:, :, :, :]))\n            print('lower loss is:{}'.format(loss))\n        # total_loss = total_loss_u + total_loss_l\n        # print('total loss is:{}'.format(total_loss))\n\ngrads = tape.gradient(loss, model.trainable_weights)\noptimizer.apply_gradients(zip(grads, model.trainable_weights))\n</code></pre>\n\n<p>number of images:  7\n2020-02-21 12:57:19.264638: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcuda.so.1\n2020-02-21 12:57:19.299154: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2020-02-21 12:57:19.300362: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1555] Found device 0 with properties: \npciBusID: 0000:0b:00.0 name: Quadro RTX 8000 computeCapability: 7.5\ncoreClock: 1.77GHz coreCount: 72 deviceMemorySize: 47.46GiB deviceMemoryBandwidth: 625.94GiB/s\n2020-02-21 12:57:19.300495: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudart.so.10.1\n2020-02-21 12:57:19.301531: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcublas.so.10\n2020-02-21 12:57:19.302656: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcufft.so.10\n2020-02-21 12:57:19.302800: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcurand.so.10\n2020-02-21 12:57:19.303857: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcusolver.so.10\n2020-02-21 12:57:19.304423: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcusparse.so.10\n2020-02-21 12:57:19.306740: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudnn.so.7\n2020-02-21 12:57:19.306856: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2020-02-21 12:57:19.308102: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2020-02-21 12:57:19.309243: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1697] Adding visible gpu devices: 0\n2020-02-21 12:57:19.309477: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA\n2020-02-21 12:57:19.335253: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 3593090000 Hz\n2020-02-21 12:57:19.335853: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55fbe0d89300 initialized for platform Host (this does not guarantee that XLA will be used). Devices:\n2020-02-21 12:57:19.335875: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version\n2020-02-21 12:57:19.336100: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2020-02-21 12:57:19.338287: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1555] Found device 0 with properties: \npciBusID: 0000:0b:00.0 name: Quadro RTX 8000 computeCapability: 7.5\ncoreClock: 1.77GHz coreCount: 72 deviceMemorySize: 47.46GiB deviceMemoryBandwidth: 625.94GiB/s\n2020-02-21 12:57:19.338321: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudart.so.10.1\n2020-02-21 12:57:19.338333: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcublas.so.10\n2020-02-21 12:57:19.338344: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcufft.so.10\n2020-02-21 12:57:19.338354: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcurand.so.10\n2020-02-21 12:57:19.338365: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcusolver.so.10\n2020-02-21 12:57:19.338375: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcusparse.so.10\n2020-02-21 12:57:19.338385: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudnn.so.7\n2020-02-21 12:57:19.338466: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2020-02-21 12:57:19.340744: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2020-02-21 12:57:19.342952: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1697] Adding visible gpu devices: 0\n2020-02-21 12:57:19.342984: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudart.so.10.1\n2020-02-21 12:57:19.420445: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1096] Device interconnect StreamExecutor with strength 1 edge matrix:\n2020-02-21 12:57:19.420465: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1102]      0 \n2020-02-21 12:57:19.420469: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1115] 0:   N \n2020-02-21 12:57:19.420626: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2020-02-21 12:57:19.421815: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2020-02-21 12:57:19.422990: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n2020-02-21 12:57:19.424134: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1241] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 46004 MB memory) -> physical GPU (device: 0, name: Quadro RTX 8000, pci bus id: 0000:0b:00.0, compute capability: 7.5)\n2020-02-21 12:57:19.425373: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55fbe2365e90 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:\n2020-02-21 12:57:19.425380: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Quadro RTX 8000, Compute Capability 7.5\nrm: invalid option -- '/'\nTry 'rm --help' for more information.\nInitializing from scratch.\nepoch 0 is started\n7\nimage number: 0\n2020-02-21 12:57:20.660563: I tensorflow/core/kernels/cuda_solvers.cc:159] Creating CudaSolver handles for stream 0x55fbe2353fb0\n2020-02-21 12:57:20.660662: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcusolver.so.10\n2020-02-21 12:57:20.871250: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcublas.so.10\n2020-02-21 12:57:21.021126: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcublas.so.10\n2020-02-21 12:57:21.155054: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudnn.so.7\nupper loss is:79981.0234375\nWARNING:tensorflow:From /home/monajemd/.conda/envs/facetvision/lib/python3.7/site-packages/tensorflow_core/python/ops/array_grad.py:563: _EagerTensorBase.cpu (from tensorflow.python.framework.ops) is deprecated and will be removed in a future version.\nInstructions for updating:\nUse tf.identity instead.\nlower loss is:105275.3515625\nimage number: 1\nupper loss is:123967.109375\nlower loss is:90015.671875\nimage number: 2\nupper loss is:74442.25\nlower loss is:80841.8125\nimage number: 3\nupper loss is:151827.796875\nlower loss is:56213.5546875\nimage number: 4\nupper loss is:107546.7890625\nlower loss is:39292.203125\nimage number: 5\nupper loss is:116781.0\nlower loss is:50309.76953125\nimage number: 6\nupper loss is:74282.4609375\nlower loss is:35550.5\nsaving model\n2020-02-21 12:57:33.090168: W tensorflow/python/util/util.cc:319] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\nWARNING:tensorflow:From /home/monajemd/.conda/envs/facetvision/lib/python3.7/site-packages/tensorflow_core/python/ops/resource_variable_ops.py:1786: calling BaseResourceVariable.<strong>init</strong> (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.\nInstructions for updating:\nIf using Keras pass *_constraint arguments to layers.\nepoch 1 is started\n7\nimage number: 0\nTraceback (most recent call last):\n  File \"/home/monajemd/Desktop/facetvision/main.py\", line 320, in \n    main(path)\n  File \"/home/monajemd/Desktop/facetvision/main.py\", line 263, in main\n    sample, frame, optimizer, intrin_pos)\n  File \"/home/monajemd/Desktop/facetvision/main.py\", line 172, in train_and_checkpoint\n    net_output_u = model(input_u)\n  File \"/home/monajemd/.conda/envs/facetvision/lib/python3.7/site-packages/tensorflow_core/python/keras/engine/base_layer.py\", line 822, in <strong>call</strong>\n    outputs = self.call(cast_inputs, *args, **kwargs)\n  File \"/home/monajemd/.conda/envs/facetvision/lib/python3.7/site-packages/tensorflow_core/python/keras/engine/network.py\", line 717, in call\n    convert_kwargs_to_constants=base_layer_utils.call_context().saving)\n  File \"/home/monajemd/.conda/envs/facetvision/lib/python3.7/site-packages/tensorflow_core/python/keras/engine/network.py\", line 891, in _run_internal_graph\n    output_tensors = layer(computed_tensors, **kwargs)\n  File \"/home/monajemd/.conda/envs/facetvision/lib/python3.7/site-packages/tensorflow_core/python/keras/engine/base_layer.py\", line 822, in <strong>call</strong>\n    outputs = self.call(cast_inputs, *args, **kwargs)\n  File \"/home/monajemd/.conda/envs/facetvision/lib/python3.7/site-packages/tensorflow_core/python/keras/layers/convolutional.py\", line 209, in call\n    outputs = self._convolution_op(inputs, self.kernel)\n  File \"/home/monajemd/.conda/envs/facetvision/lib/python3.7/site-packages/tensorflow_core/python/ops/nn_ops.py\", line 1135, in <strong>call</strong>\n    return self.conv_op(inp, filter)\n  File \"/home/monajemd/.conda/envs/facetvision/lib/python3.7/site-packages/tensorflow_core/python/ops/nn_ops.py\", line 640, in <strong>call</strong>\n    return self.call(inp, filter)\n  File \"/home/monajemd/.conda/envs/facetvision/lib/python3.7/site-packages/tensorflow_core/python/ops/nn_ops.py\", line 616, in _with_space_to_batch_call\n    block_shape=self.dilation_rate)\n  File \"/home/monajemd/.conda/envs/facetvision/lib/python3.7/site-packages/tensorflow_core/python/ops/array_ops.py\", line 3282, in required_space_to_batch_paddings\n    [input_shape, block_shape]):\n  File \"/home/monajemd/.conda/envs/facetvision/lib/python3.7/site-packages/tensorflow_core/python/framework/ops.py\", line 6185, in name_scope\n    return graph_value.graph.name_scope(name)\n  File \"/home/monajemd/.conda/envs/facetvision/lib/python3.7/site-packages/tensorflow_core/python/framework/ops.py\", line 416, in graph\n    return self._op.graph\n  File \"/home/monajemd/.conda/envs/facetvision/lib/python3.7/site-packages/tensorflow_core/python/framework/ops.py\", line 2225, in graph\n    return self._graph\nAttributeError: 'Operation' object has no attribute '_graph'</p>\n\n<p>Process finished with exit code 1</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 50}]