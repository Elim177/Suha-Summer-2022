[{"items": [{"tags": ["tensorflow", "google-colaboratory", "tensorflow2.0"], "owner": {"account_id": 9914032, "reputation": 2374, "user_id": 7339624, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-6jIAe62Q10s/AAAAAAAAAAI/AAAAAAAAABw/kRBVixTmLmk/photo.jpg?sz=256", "display_name": "Peyman", "link": "https://stackoverflow.com/users/7339624/peyman"}, "is_answered": false, "view_count": 372, "answer_count": 0, "score": 0, "last_activity_date": 1603664432, "creation_date": 1603650502, "last_edit_date": 1603664432, "question_id": 64527292, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/64527292/google-colab-after-running-this-tensorflow-code-your-session-crashed-for-an-un", "title": "Google Colab after running this TensorFlow code: &quot;Your session crashed for an unknown reason.&quot; &quot;an illegal memory access was encountered&quot;", "body": "<p>I'm coding a simple TensorFlow code on Colab. I'm trying to code Word2Vec from scratch (using the method <a href=\"http://jalammar.github.io/illustrated-word2vec/#word2vec-training-process\" rel=\"nofollow noreferrer\">here</a>). <code>neighbors</code> here are just a bunch of tuples like <code>(&quot;cat&quot;, &quot;nice&quot;)</code> and <code>y</code> is their labels <code>0</code> or <code>1</code>.</p>\n<p>The problem is after running this block, Colab will crash almost instantly and I don't know how to know why. (<strong>AND my runtime is on GPU</strong> I'm aware of <a href=\"https://stackoverflow.com/questions/59703866/google-colab-your-session-crashed-for-an-unknown-reason\">this question</a>).</p>\n<p>Its log says &quot;<strong>an illegal memory access was encountered</strong>&quot;. I don't understand what is illegal here!</p>\n<pre><code>embeding_tensor = tf.Variable(tf.random.uniform(shape=[len(words_lst), embeding_size]))\ncontext_tensor = tf.Variable(tf.random.uniform(shape=[len(words_lst), embeding_size]))\n\nfor idx, neighbor in enumerate(neighbors):\n  x, y = data_generator(neighbor)\n  y = tf.convert_to_tensor(y, dtype='float32')\n\n  with tf.GradientTape() as t:    \n    middle = tf.gather(embeding_tensor, word2index[x[0][0]])\n    neighbor_choices = tf.gather(context_tensor, [word2index[i[1]] for i in x])\n\n    scores = tf.tensordot(neighbor_choices, middle, 1)\n    prediction = tf.nn.sigmoid(scores)\n    loss = y - prediction\n\n    g_embed, g_context = t.gradient(loss, [embeding_tensor, context_tensor])\n\n    tf.compat.v1.scatter_sub(embeding_tensor, [word2index[x[0][0]]], g_embed)\n</code></pre>\n<p>Here is the log:</p>\n<pre><code>Oct 25, 2020, 9:44:09 PM    WARNING WARNING:root:kernel 8c6ec4a8-cabd-4d91-a214-1c3a91f36571 restarted\nOct 25, 2020, 9:44:09 PM    INFO    KernelRestarter: restarting kernel (1/5), keep random ports\nOct 25, 2020, 9:44:06 PM    WARNING 2020-10-25 18:14:06.799062: F tensorflow/core/common_runtime/gpu/gpu_event_mgr.cc:220] Unexpected Event status: 1\nOct 25, 2020, 9:44:06 PM    WARNING 2020-10-25 18:14:06.799003: E tensorflow/stream_executor/cuda/cuda_event.cc:29] Error polling for event status: failed to query event: CUDA_ERROR_ILLEGAL_ADDRESS: an illegal memory access was encountered\nOct 25, 2020, 9:44:06 PM    WARNING 2020-10-25 18:14:06.383027: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcublas.so.10\nOct 25, 2020, 9:44:05 PM    WARNING 2020-10-25 18:14:05.542284: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1402] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 13962 MB memory) -&gt; physical GPU (device: 0, name: Tesla T4, pci bus id: 0000:00:04.0, compute capability: 7.5)\nOct 25, 2020, 9:44:05 PM    WARNING 2020-10-25 18:14:05.542217: W tensorflow/core/common_runtime/gpu/gpu_bfc_allocator.cc:39] Overriding allow_growth setting because the TF_FORCE_GPU_ALLOW_GROWTH environment variable is set. Original config value was 0.\nOct 25, 2020, 9:44:05 PM    WARNING 2020-10-25 18:14:05.541345: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:982] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\nOct 25, 2020, 9:44:05 PM    WARNING 2020-10-25 18:14:05.540333: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:982] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\nOct 25, 2020, 9:44:05 PM    WARNING 2020-10-25 18:14:05.539944: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1276] 0: N\n</code></pre>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 44}]