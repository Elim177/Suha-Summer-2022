[{"items": [{"tags": ["python", "tensorflow", "tensorflow-datasets", "tensorflow2.0"], "owner": {"account_id": 15701601, "reputation": 99, "user_id": 11329575, "user_type": "registered", "profile_image": "https://graph.facebook.com/10158425201789056/picture?type=large", "display_name": "Steven Hickson", "link": "https://stackoverflow.com/users/11329575/steven-hickson"}, "is_answered": true, "view_count": 24126, "accepted_answer_id": 55617894, "answer_count": 3, "score": 8, "last_activity_date": 1599613209, "creation_date": 1554734956, "last_edit_date": 1554909189, "question_id": 55576133, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/55576133/tensorflow-2-0-dataset-iter-is-only-supported-when-eager-execution-is-enab", "title": "TensorFlow 2.0 dataset.__iter__() is only supported when eager execution is enabled", "body": "<p>I'm using the following custom training code in TensorFlow 2:</p>\n\n<pre><code>def parse_function(filename, filename2):\n    image = read_image(fn)\n    def ret1(): return image, read_image(fn2), 0\n    def ret2(): return image, preprocess(image), 1\n    return tf.case({tf.less(tf.random.uniform([1])[0], tf.constant(0.5)): ret2}, default=ret1)\n\ndataset = tf.data.Dataset.from_tensor_slices((train,shuffled_train))\ndataset = dataset.shuffle(len(train))\ndataset = dataset.map(parse_function, num_parallel_calls=4)\ndataset = dataset.batch(1)\ndataset = dataset.prefetch(buffer_size=4)\n\n@tf.function\ndef train(model, dataset, optimizer):\n    for x1, x2, y in enumerate(dataset):\n        with tf.GradientTape() as tape:\n            left, right = model([x1, x2])\n            loss = contrastive_loss(left, right, tf.cast(y, tf.float32))\n        gradients = tape.gradient(loss, model.trainable_variables)\n        optimizer.apply_gradients(zip(gradients, model.trainable_variables))\n\nsiamese_net.compile(optimizer=tf.keras.optimizers.RMSprop(learning_rate=1e-3))\ntrain(siamese_net, dataset, tf.keras.optimizers.RMSprop(learning_rate=1e-3))\n</code></pre>\n\n<p>This code gives me the error:</p>\n\n<pre><code>dataset.__iter__() is only supported when eager execution is enabled.\n</code></pre>\n\n<p>However, it's in TensorFlow 2.0 so eager is enabled by default.\n<code>tf.executing_eagerly()</code> also returns 'True'.</p>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 54}]