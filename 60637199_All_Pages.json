[{"items": [{"tags": ["tensorflow", "conv-neural-network", "keras-layer", "tf.keras", "keras-2"], "owner": {"user_type": "does_not_exist", "display_name": "user11549734"}, "is_answered": true, "view_count": 548, "answer_count": 1, "score": 0, "last_activity_date": 1585738646, "creation_date": 1583933336, "last_edit_date": 1583943067, "question_id": 60637199, "content_license": "CC BY-SA 4.0", "link": "https://stackoverflow.com/questions/60637199/error-in-removing-the-first-layer-of-keras-model", "title": "Error in removing the first layer of keras model", "body": "<pre><code>import numpy as np\nfrom keras.applications.vgg19 import decode_predictions\nfrom prettytable import PrettyTable\nimport time\nfrom keras import backend as K\nfrom tensorflow import keras\nfrom tensorflow.python import keras\nfrom keras import models, layers, Model, Input\nimport tensorflow as tf\n\nmodel_2=keras.models.load_model('model_2.h5',compile=False)\nmodel_2.summary()\n\npredictions1= np.load('D:/predictions_result.npy')\ndef profiler(model, test_input):\n data_input=test_input\n for layer in model.layers:\n    start = time.time()\n    im_imput=keras.layers.Input(batch_shape=model.get_layer(layer.name).get_input_shape_at(0))\n    im_out = layer(im_imput)\n    new_model = keras.models.Model(inputs=im_imput,outputs=im_out)\n    data_input = new_model.predict(data_input)\n    end = time.time() - start\n    print(end)\n    result=1\n\n\nprofiler(model_2,predictions1)\n\ntmp=np.zeros((1,224,224,64))\n\nfor i in range(0,1):\n   tmp[i,:,:,:]=predictions1[i,:]\n\npredictions2 = model_2.predict(tmp)\nlabel_vgg19 = decode_predictions(predictions2)\nprint ('label_vgg19 =', label_vgg19)\n</code></pre>\n\n<p>When I try to run the above code I get below error. My question is how to remove the first layer of the model after loading. I initially split VGG model into sub-models and then load the submodel. I tried different approaches but none is working. Help is highly appreciated.</p>\n\n<pre><code>  Traceback (most recent call last):\n  File \"C:/Users/40227422/PycharmProjects/model_partititon/model_2_sock.py\", line 42, in &lt;module&gt;\n  profiler(model_2,predictions1)\n  File \"C:/Users/40227422/PycharmProjects/model_partititon/model_2_sock.py\", line 28, in the \n    profiler\n  data_input = new_model.predict(data_input)\n  File \"C:\\Users\\40227422\\AppData\\Local\\Continuum\\miniconda3\\envs\\tensorflow\\lib\\site- \n  packages\\tensorflow\\python\\keras\\engine\\training_utils.py\", line 332, in standardize_input_data\n  ' but got array with shape ' + str(data_shape))\n  ValueError: Error when checking input: expected input_1 to have shape (224, 224, 3) but got array \n  with shape (224, 224, 64)\n</code></pre>\n\n<p>when I try to use kerassurgeon to delete a layer using below code I get error \nValueError: not enough values to unpack (expected 2, got 0)</p>\n\n<pre><code> from kerassurgeon import Surgeon\n surgeon = Surgeon(model_2)\n layer_1 = model_2.layers[0] # selecting 2nd layer\n\n surgeon.add_job('delete_layer', layer_1)\n new_model = surgeon.operate()\n</code></pre>\n"}], "has_more": false, "quota_max": 300, "quota_remaining": 242}]